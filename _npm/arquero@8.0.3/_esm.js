/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/arquero@8.0.3/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{parse as t}from"../acorn@8.14.1/_esm.js";import{tableFromColumns as e,columnFromArray as n,columnFromValues as r,tableToIPC as o,tableFromIPC as s}from"../@uwdata/flechette@2.0.0/_esm.js";const a=2147483648;class i{constructor(t){this._size=t,this._bits=new Uint32Array(Math.ceil(t/32))}get length(){return this._size}count(){const t=this._bits.length;let e=0;for(let n=0;n<t;++n)for(let t=this._bits[n];t;++e)t&=t-1;return e}get(t){return this._bits[t>>5]&a>>>t}set(t){this._bits[t>>5]|=a>>>t}clear(t){this._bits[t>>5]&=~(a>>>t)}scan(t){for(let e=this.next(0);e>=0;e=this.next(e+1))t(e)}next(t){const e=this._bits,n=e.length;let r=t>>5,o=e[r]&4294967295>>>t;for(;r<n;o=e[++r])if(0!==o)return(r<<5)+Math.clz32(o);return-1}nth(t){let e=this.next(0);for(;t--&&e>=0;)e=this.next(e+1);return e}not(){const t=this._bits,e=t.length;for(let n=0;n<e;++n)t[n]=~t[n];const n=this._size%32;return n&&(t[e-1]&=a>>n-1),this}and(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]&=n[t]}return this}or(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]|=n[t]}return this}}function u(t){return t instanceof Date}function c(t){return t instanceof RegExp}function l(t){return t===Object(t)}function f(t,e){return null!=t&&null!=e&&t==t&&e==e&&(t===e||(u(t)||u(e)?+t==+e:c(t)&&c(e)?t+""==e+"":!(!l(t)||!l(e))&&function(t,e){if(Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;if(t.length||e.length)return m(t,e);const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;if(n.sort(),r.sort(),!m(n,r,((t,e)=>t===e)))return!1;const o=n.length;for(let r=0;r<o;++r){const o=n[r];if(!f(t[o],e[o]))return!1}return!0}(t,e)))}function m(t,e,n=f){const r=t.length;if(r!==e.length)return!1;for(let o=0;o<r;++o)if(!n(t[o],e[o]))return!1;return!0}function d(t,e,n){let r=arguments.length;t=+t,e=+e,n=r<2?(e=t,t=0,1):r<3?1:+n,r=0|Math.max(0,Math.ceil((e-t)/n));const o=new Array(r);for(let e=0;e<r;++e)o[e]=t+e*n;return o}const h=void 0;function p(t){return Array.isArray(t)}const g=Object.getPrototypeOf(Int8Array);function v(t){return t instanceof g}function y(t){return p(t)||v(t)}function _(t){return"string"==typeof t}function w(t){return null!=t&&t==t}const b=t=>y(t)||_(t);var x=Object.freeze({__proto__:null,compact:function(t){return y(t)?t.filter((t=>w(t))):t},concat:function(...t){return[].concat(...t)},includes:function(t,e,n){return!!b(t)&&t.includes(e,n)},indexof:function(t,e){return b(t)?t.indexOf(e):-1},join:function(t,e){return y(t)?t.join(e):h},lastindexof:function(t,e){return b(t)?t.lastIndexOf(e):-1},length:function(t){return b(t)?t.length:0},pluck:function(t,e){return y(t)?t.map((t=>w(t)?t[e]:h)):h},reverse:function(t){return y(t)?t.slice().reverse():_(t)?t.split("").reverse().join(""):h},slice:function(t,e,n){return b(t)?t.slice(e,n):h}});function $(t,e,n="0"){const r=t+"",o=r.length;return o<e?Array(e-o+1).join(n)+r:r}const M=t=>(t<10?"0":"")+t;function O(t,e,n,r,o,s,a,i,u){const c=i?"Z":"";return(t=>t<0?"-"+$(-t,6):t>9999?"+"+$(t,6):$(t,4))(t)+"-"+M(e+1)+"-"+M(n)+(!u||a?"T"+M(r)+":"+M(o)+":"+M(s)+"."+$(a,3)+c:s?"T"+M(r)+":"+M(o)+":"+M(s)+c:o||r||!i?"T"+M(r)+":"+M(o)+c:"")}function j(t,e){return isNaN(t)?"Invalid Date":O(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),!1,e)}function E(t,e){return isNaN(t)?"Invalid Date":O(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds(),!0,e)}const k=/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function S(t){return t.match(k)&&!isNaN(Date.parse(t))}const N=864e5,A=6048e5,C=new Date,T=new Date,z=t=>(C.setTime("string"==typeof t?function(t,e=Date.parse){return S(t)?e(t):t}(t):t),C);var D=Object.freeze({__proto__:null,format_date:function(t,e){return j(z(t),!e)},format_utcdate:function(t,e){return E(z(t),!e)},now:function(){return Date.now()},timestamp:function(t){return+z(t)},datetime:function(t,e,n,r,o,s,a){return arguments.length?new Date(t,e||0,null==n?1:n,r||0,o||0,s||0,a||0):new Date(Date.now())},year:function(t){return z(t).getFullYear()},quarter:function(t){return Math.floor(z(t).getMonth()/3)},month:function(t){return z(t).getMonth()},week:function(t,e){const n=e||0;T.setTime(+t),T.setDate(T.getDate()-(T.getDay()+7-n)%7),T.setHours(0,0,0,0),C.setTime(+t),C.setMonth(0),C.setDate(1),C.setDate(1-(C.getDay()+7-n)%7),C.setHours(0,0,0,0);const r=6e4*(T.getTimezoneOffset()-C.getTimezoneOffset());return Math.floor((+T-+C+1-r)/A)},date:function(t){return z(t).getDate()},dayofyear:function(t){T.setTime(+t),T.setHours(0,0,0,0),C.setTime(+T),C.setMonth(0),C.setDate(1);const e=6e4*(T.getTimezoneOffset()-C.getTimezoneOffset());return Math.floor(1+(+T-+C-e)/N)},dayofweek:function(t){return z(t).getDay()},hours:function(t){return z(t).getHours()},minutes:function(t){return z(t).getMinutes()},seconds:function(t){return z(t).getSeconds()},milliseconds:function(t){return z(t).getMilliseconds()},utcdatetime:function(t,e,n,r,o,s,a){return arguments.length?new Date(Date.UTC(t,e||0,null==n?1:n,r||0,o||0,s||0,a||0)):new Date(Date.now())},utcyear:function(t){return z(t).getUTCFullYear()},utcquarter:function(t){return Math.floor(z(t).getUTCMonth()/3)},utcmonth:function(t){return z(t).getUTCMonth()},utcweek:function(t,e){const n=e||0;return T.setTime(+t),T.setUTCDate(T.getUTCDate()-(T.getUTCDay()+7-n)%7),T.setUTCHours(0,0,0,0),C.setTime(+t),C.setUTCMonth(0),C.setUTCDate(1),C.setUTCDate(1-(C.getUTCDay()+7-n)%7),C.setUTCHours(0,0,0,0),Math.floor((+T-+C+1)/A)},utcdate:function(t){return z(t).getUTCDate()},utcdayofyear:function(t){T.setTime(+t),T.setUTCHours(0,0,0,0);const e=Date.UTC(T.getUTCFullYear(),0,1);return Math.floor(1+(+T-e)/N)},utcdayofweek:function(t){return z(t).getUTCDay()},utchours:function(t){return z(t).getUTCHours()},utcminutes:function(t){return z(t).getUTCMinutes()},utcseconds:function(t){return z(t).getUTCSeconds()},utcmilliseconds:function(t){return z(t).getUTCMilliseconds()}});var U=Object.freeze({__proto__:null,parse_json:function(t){return JSON.parse(t)},to_json:function(t){return JSON.stringify(t)}});let F=Math.random;function R(){return F()}function q(t){F=w(t)&&isFinite(t=+t)?function(t){const e=1664525,n=1013904223,r=1/4294967296;return t=0|(0<=t&&t<1?t/r:Math.abs(t)),()=>r*((t=e*t+n|0)>>>0)}(t):Math.random}var I=Object.freeze({__proto__:null,random:function(){return R()},is_nan:function(t){return Number.isNaN(t)},is_finite:function(t){return Number.isFinite(t)},abs:function(t){return Math.abs(t)},cbrt:function(t){return Math.cbrt(t)},ceil:function(t){return Math.ceil(t)},clz32:function(t){return Math.clz32(t)},exp:function(t){return Math.exp(t)},expm1:function(t){return Math.expm1(t)},floor:function(t){return Math.floor(t)},fround:function(t){return Math.fround(t)},greatest:function(...t){return Math.max(...t)},least:function(...t){return Math.min(...t)},log:function(t){return Math.log(t)},log10:function(t){return Math.log10(t)},log1p:function(t){return Math.log1p(t)},log2:function(t){return Math.log2(t)},pow:function(t,e){return Math.pow(t,e)},round:function(t){return Math.round(t)},sign:function(t){return Math.sign(t)},sqrt:function(t){return Math.sqrt(t)},trunc:function(t){return Math.trunc(t)},degrees:function(t){return 180*t/Math.PI},radians:function(t){return Math.PI*t/180},acos:function(t){return Math.acos(t)},acosh:function(t){return Math.acosh(t)},asin:function(t){return Math.asin(t)},asinh:function(t){return Math.asinh(t)},atan:function(t){return Math.atan(t)},atan2:function(t,e){return Math.atan2(t,e)},atanh:function(t){return Math.atanh(t)},cos:function(t){return Math.cos(t)},cosh:function(t){return Math.cosh(t)},sin:function(t){return Math.sin(t)},sinh:function(t){return Math.sinh(t)},tan:function(t){return Math.tan(t)},tanh:function(t){return Math.tanh(t)}});function P(t){return t instanceof Map}function L(t){return P(t)||function(t){return t instanceof Set}(t)}function G(t){return Array.from(t)}var J=Object.freeze({__proto__:null,has:function(t,e){return L(t)?t.has(e):null!=t&&Object.hasOwn(t,`${e}`)},keys:function(t){return P(t)?G(t.keys()):null!=t?Object.keys(t):[]},values:function(t){return L(t)?G(t.values()):null!=t?Object.values(t):[]},entries:function(t){return L(t)?G(t.entries()):null!=t?Object.entries(t):[]},object:function(t){return t?Object.fromEntries(t):h}});var H=Object.freeze({__proto__:null,parse_date:function(t){return null==t?t:new Date(t)},parse_float:function(t){return null==t?t:Number.parseFloat(t)},parse_int:function(t,e){return null==t?t:Number.parseInt(t,e)},endswith:function(t,e,n){return null!=t&&String(t).endsWith(e,n)},match:function(t,e,n){const r=null==t?t:String(t).match(e);return null==n||null==r?r:"number"==typeof n?r[n]:r.groups?r.groups[n]:null},normalize:function(t,e){return null==t?t:String(t).normalize(e)},padend:function(t,e,n){return null==t?t:String(t).padEnd(e,n)},padstart:function(t,e,n){return null==t?t:String(t).padStart(e,n)},upper:function(t){return null==t?t:String(t).toUpperCase()},lower:function(t){return null==t?t:String(t).toLowerCase()},repeat:function(t,e){return null==t?t:String(t).repeat(e)},replace:function(t,e,n){return null==t?t:String(t).replace(e,String(n))},split:function(t,e,n){return null==t?[]:String(t).split(e,n)},startswith:function(t,e,n){return null!=t&&String(t).startsWith(e,n)},substring:function(t,e,n){return null==t?t:String(t).substring(e,n)},trim:function(t){return null==t?t:String(t).trim()}});const V={bin:function(t,e,n,r,o){return null==t?null:t<e?-1/0:t>n?1/0:(t=Math.max(e,Math.min(t,n)),e+r*Math.floor(1e-14+(t-e)/r+(o||0)))},equal:f,recode:function(t,e,n){if(e instanceof Map){if(e.has(t))return e.get(t)}else{const n=`${t}`;if(Object.hasOwn(e,n))return e[n]}return void 0!==n?n:t},sequence:d,...x,...D,...U,...I,...J,...H};function W(t){return null!=t?p(t)?t:[t]:[]}function B(t){return"bigint"==typeof t}function Y(t){return void 0===t?t+"":B(t)?t+"n":JSON.stringify(t)}class Q{constructor(t,e,n){this.name=t,this.fields=e,this.params=n}toString(){const t=[...this.fields.map((t=>`d[${Y(t)}]`)),...this.params.map(Y)];return`d => op.${this.name}(${t})`}toObject(){return{expr:this.toString(),func:!0}}}function Z(t,e=[],n=[]){return new Q(t,W(e),W(n))}const K=t=>Z("any",t),X=()=>Z("count"),tt=t=>Z("array_agg",t),et=t=>Z("array_agg_distinct",t),nt=(t,e)=>Z("map_agg",[t,e]),rt=(t,e)=>Z("object_agg",[t,e]),ot=(t,e)=>Z("entries_agg",[t,e]),st={...V,row_object:(...t)=>Z("row_object",null,t.flat()),count:X,any:K,array_agg:tt,array_agg_distinct:et,object_agg:rt,map_agg:nt,entries_agg:ot,valid:t=>Z("valid",t),invalid:t=>Z("invalid",t),distinct:t=>Z("distinct",t),mode:t=>Z("mode",t),sum:t=>Z("sum",t),product:t=>Z("product",t),mean:t=>Z("mean",t),average:t=>Z("average",t),variance:t=>Z("variance",t),variancep:t=>Z("variancep",t),stdev:t=>Z("stdev",t),stdevp:t=>Z("stdevp",t),min:t=>Z("min",t),max:t=>Z("max",t),quantile:(t,e)=>Z("quantile",t,e),median:t=>Z("median",t),covariance:(t,e)=>Z("covariance",[t,e]),covariancep:(t,e)=>Z("covariancep",[t,e]),corr:(t,e)=>Z("corr",[t,e]),bins:(t,e,n,r,o)=>Z("bins",t,[e,n,r,o]),row_number:()=>Z("row_number"),rank:()=>Z("rank"),avg_rank:()=>Z("avg_rank"),dense_rank:()=>Z("dense_rank"),percent_rank:()=>Z("percent_rank"),cume_dist:()=>Z("cume_dist"),ntile:t=>Z("ntile",null,t),lag:(t,e,n)=>Z("lag",t,[e,n]),lead:(t,e,n)=>Z("lead",t,[e,n]),first_value:t=>Z("first_value",t),last_value:t=>Z("last_value",t),nth_value:(t,e)=>Z("nth_value",t,e),fill_down:(t,e)=>Z("fill_down",t,e),fill_up:(t,e)=>Z("fill_up",t,e)};function at(t,e){throw Error(t,{cause:e})}function it(t){return"function"==typeof t}function ut(t,e){const n=Array(t);if(it(e))for(let r=0;r<t;++r)n[r]=e(r);else n.fill(e);return n}function ct(t){const e=typeof t;return"string"===e?`"${t}"`:"object"===e&&t?u(t)?+t:p(t)||v(t)?`[${t.map(ct)}]`:c(t)?t+"":function(t){let e="{",n=-1;for(const r in t)++n>0&&(e+=","),e+=`"${r}":${ct(t[r])}`;return e+="}",e}(t):t}function lt(t,e){const n=t.length;return 1===n?(e,n)=>ct(t[0](e,n)):(r,o)=>{let s="";for(let a=0;a<n;++a){a>0&&(s+="|");const n=t[a](r,o);if(e&&(null==n||n!=n))return null;s+=ct(n)}return s}}function ft(){}function mt(t){return t.init=t.init||ft,t.add=t.add||ft,t.rem=t.rem||ft,t}function dt(t,e){return t.product_v=!1,t.product=e}const ht={count:{create:()=>mt({value:t=>t.count}),param:[]},array_agg:{create:()=>mt({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[1]},object_agg:{create:()=>mt({init:t=>t.values=!0,value:t=>Object.fromEntries(t.list.values())}),param:[2]},map_agg:{create:()=>mt({init:t=>t.values=!0,value:t=>new Map(t.list.values())}),param:[2]},entries_agg:{create:()=>mt({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[2]},any:{create:()=>mt({add:(t,e)=>{null==t.any&&(t.any=e)},value:t=>t.valid?t.any:h}),param:[1]},valid:{create:()=>mt({value:t=>t.valid}),param:[1]},invalid:{create:()=>mt({value:t=>t.count-t.valid}),param:[1]},distinct:{create:()=>({init:t=>t.distinct=function(){const t=new Map;return{count:()=>t.size,values:()=>Array.from(t.values(),(t=>t.v)),increment(e){const n=ct(e),r=t.get(n);r?++r.n:t.set(n,{v:e,n:1})},decrement(e){const n=ct(e),r=t.get(n);1===r.n?t.delete(n):--r.n},forEach(e){t.forEach((({v:t,n:n})=>e(t,n)))}}}(),value:t=>t.distinct.count()+(t.valid===t.count?0:1),add:(t,e)=>t.distinct.increment(e),rem:(t,e)=>t.distinct.decrement(e)}),param:[1]},array_agg_distinct:{create:()=>mt({value:t=>t.distinct.values()}),param:[1],req:["distinct"]},mode:{create:()=>mt({value:t=>{let e=h,n=0;return t.distinct.forEach(((t,r)=>{r>n&&(n=r,e=t)})),e}}),param:[1],req:["distinct"]},sum:{create:()=>({init:t=>t.sum=0,value:t=>t.valid?t.sum:h,add:(t,e)=>B(e)?0===t.sum?t.sum=e:t.sum+=e:t.sum+=+e,rem:(t,e)=>t.sum-=e}),param:[1]},product:{create:()=>({init:t=>dt(t,1),value:t=>t.valid?t.product_v?dt(t,function(t,e=0,n=t.length){let r=t[e++];for(let o=e;o<n;++o)r*=t[o];return r}(t.list.values())):t.product:void 0,add:(t,e)=>B(e)&&1===t.product?t.product=e:t.product*=e,rem:(t,e)=>0==e||e===1/0||e===-1/0?t.product_v=!0:t.product/=e}),param:[1],stream:["array_agg"]},mean:{create:()=>({init:t=>t.mean=0,value:t=>t.valid?t.mean:h,add:(t,e)=>{t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid},rem:(t,e)=>{t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean}}),param:[1]},average:{create:()=>mt({value:t=>t.valid?t.mean:h}),param:[1],req:["mean"]},variance:{create:()=>({init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):h,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean)}),param:[1],req:["mean"]},variancep:{create:()=>mt({value:t=>t.valid>1?t.dev/t.valid:h}),param:[1],req:["variance"]},stdev:{create:()=>mt({value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):h}),param:[1],req:["variance"]},stdevp:{create:()=>mt({value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):h}),param:[1],req:["variance"]},min:{create:()=>({init:t=>t.min=h,value:t=>t.min=Number.isNaN(t.min)?t.list.min():t.min,add:(t,e)=>{(e<t.min||t.min===h)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)}}),param:[1],stream:["array_agg"]},max:{create:()=>({init:t=>t.max=h,value:t=>t.max=Number.isNaN(t.max)?t.list.max():t.max,add:(t,e)=>{(e>t.max||t.max===h)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)}}),param:[1],stream:["array_agg"]},quantile:{create:t=>mt({value:e=>e.list.quantile(t)}),param:[1,1],req:["array_agg"]},median:{create:()=>mt({value:t=>t.list.quantile(.5)}),param:[1],req:["array_agg"]},covariance:{create:()=>({init:t=>{t.cov=t.mean_x=t.mean_y=t.dev_x=t.dev_y=0},value:t=>t.valid>1?t.cov/(t.valid-1):h,add:(t,e,n)=>{const r=e-t.mean_x,o=n-t.mean_y;t.mean_x+=r/t.valid,t.mean_y+=o/t.valid;const s=n-t.mean_y;t.dev_x+=r*(e-t.mean_x),t.dev_y+=o*s,t.cov+=r*s},rem:(t,e,n)=>{const r=e-t.mean_x,o=n-t.mean_y;t.mean_x-=t.valid?r/t.valid:t.mean_x,t.mean_y-=t.valid?o/t.valid:t.mean_y;const s=n-t.mean_y;t.dev_x-=r*(e-t.mean_x),t.dev_y-=o*s,t.cov-=r*s}}),param:[2]},covariancep:{create:()=>mt({value:t=>t.valid>1?t.cov/t.valid:h}),param:[2],req:["covariance"]},corr:{create:()=>mt({value:t=>t.valid>1?t.cov/(Math.sqrt(t.dev_x)*Math.sqrt(t.dev_y)):h}),param:[2],req:["covariance"]},bins:{create:(t,e,n,r)=>mt({value:o=>function(t,e,n=15,r=!0,o=0,s){const a=Math.LN10;if(null==s){const r=Math.ceil(Math.log(n)/a),i=e-t||Math.abs(t)||1,u=[5,2];for(s=Math.max(o,Math.pow(10,Math.round(Math.log(i)/a)-r));Math.ceil(i/s)>n;)s*=10;const c=u.length;for(let t=0;t<c;++t){const e=s/u[t];e>=o&&i/e<=n&&(s=e)}}if(r){let n=Math.log(s);const r=n>=0?0:1+~~(-n/a),o=Math.pow(10,-r-1);n=Math.floor(t/s+o)*s,t=t<n?n-s:n,e=Math.ceil(e/s)*s}return[t,e===t?t+s:e,s]}(o.min,o.max,t,e,n,r)}),param:[1,4],req:["min","max"]}},pt={create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?t=n+1:t}}},param:[]},gt={create(){let t;return{init:()=>t=0,value:e=>{const{index:n,peer:r,size:o}=e;let s=n;if(t<s){for(;s+1<o&&r(s+1);)++s;t=s}return(1+t)/o}}},param:[]},vt={row_number:{create:()=>({init:ft,value:t=>t.index+1}),param:[]},rank:pt,avg_rank:{create(){let t,e;return{init:()=>(t=-1,e=1),value:n=>{const r=n.index;if(r>=t){for(e=t=r+1;n.peer(t);e+=++t);e/=t-r}return e}}},param:[]},dense_rank:{create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?++t:t}}},param:[]},percent_rank:{create(){const{init:t,value:e}=pt.create();return{init:t,value:t=>(e(t)-1)/(t.size-1)}},param:[]},cume_dist:gt,ntile:{create(t){(t=+t)>0||at("ntile num must be greater than zero.");const{init:e,value:n}=gt.create();return{init:e,value:e=>Math.ceil(t*n(e))}},param:[0,1]},lag:{create:(t,e=h)=>(t=+t||1,{init:ft,value:(n,r)=>{const o=n.index-t;return o>=0?n.value(o,r):e}}),param:[1,2]},lead:{create:(t,e=h)=>(t=+t||1,{init:ft,value:(n,r)=>{const o=n.index+t;return o<n.size?n.value(o,r):e}}),param:[1,2]},first_value:{create:()=>({init:ft,value:(t,e)=>t.value(t.i0,e)}),param:[1]},last_value:{create:()=>({init:ft,value:(t,e)=>t.value(t.i1-1,e)}),param:[1]},nth_value:{create:t=>((t=+t)>0||at("nth_value nth must be greater than zero."),{init:ft,value:(e,n)=>{const r=e.i0+(t-1);return r<e.i1?e.value(r,n):h}}),param:[1,1]},fill_down:{create(t=h){let e;return{init:()=>e=t,value:(t,n)=>{const r=t.value(t.index,n);return w(r)?e=r:e}}},param:[1,1]},fill_up:{create(t=h){let e,n;return{init:()=>(e=t,n=-1),value:(r,o)=>r.index<=n?e:(n=function(t,e,n){for(const r=t.size;n<r;++n)if(w(t.value(n,e)))return n;return-1}(r,o,r.index))>=0?e=r.value(n,o):(n=r.size,e=t)}},param:[1,1]}};function yt(t){return Object.hasOwn(ht,t)}function _t(t){return Object.hasOwn(vt,t)}function wt(t){return Object.hasOwn(V,t)||"row_object"===t}function bt(t){return yt(t)&&ht[t]}function xt(t){return _t(t)&&vt[t]}function $t(t,e=(t,e)=>t,n=""){const r=t.length;if(!r)return"";let o=e(t[0],0);for(let s=1;s<r;++s)o+=n+e(t[s],s);return o}function Mt(t,e,...n){const r=["_","$"],o=r.slice(0,n.length);return o.push('"use strict"; const '+n.map(((t,e)=>t.map(((t,n)=>`${r[e]}${n} = ${r[e]}[${n}]`)).join(", "))).join(", ")+`; return (${t}) => ${e};`),Function(...o)(...n)}function Ot(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function jt(t){return B(t)?t:+t}class Et{constructor(t){this._values=t||[],this._sorted=null,this._start=0}values(t){return this._start&&(this._values=this._values.slice(this._start),this._start=0),t?this._values.slice():this._values}add(t){this._values.push(t),this._sorted=null}rem(){this._start+=1,this._sorted=null}min(){return this._sorted&&this._sorted.length?this._sorted[0]:function(t,e=0,n=t.length){let r=n?t[e++]:h;for(let o=e;o<n;++o)r>t[o]&&(r=t[o]);return r}(this._values,this._start)}max(){return this._sorted&&this._sorted.length?this._sorted[this._sorted.length-1]:function(t,e=0,n=t.length){let r=n?t[e++]:h;for(let o=e;o<n;++o)r<t[o]&&(r=t[o]);return r}(this._values,this._start)}quantile(t){return this._sorted||(this._sorted=this.values(!0),this._sorted.sort(Ot)),function(t,e){const n=t.length;if(!n)return h;if((e=+e)<=0||n<2)return jt(t[0]);if(e>=1)return jt(t[n-1]);const r=(n-1)*e,o=Math.floor(r),s=jt(t[o]);return B(s)?s:s+(jt(t[o+1])-s)*(r-o)}(this._sorted,t)}}class kt{constructor(t){this._outputs=t}size(){return this._outputs.length}outputs(){return this._outputs}init(t){return{}}add(t,e,n){}rem(t,e,n){}write(t,e,n){}}const St=(t,e,n)=>Mt(e,"{"+$t(t,((t,r)=>`_${r}.${n}(${e});`))+"}",t);function Nt(t,e){const{ops:n,output:r}=function(t,e){const n={},r=[];function o(t,s=[]){const a=t+":"+s;if(n[a])return n[a];const i=bt(t),u=i.create(...s);return e<0&&i.stream&&i.stream.forEach((t=>o(t,[]))),i.req&&i.req.forEach((t=>o(t,[]))),n[a]=u,r.push(u),u}const s=t.map((t=>{const e=o(t.name,t.params);return e.output=t.id,e}));return{ops:r,output:s}}(t,e),o=t[0].fields,s=o.length;return new(0===s?At:1===s?Ct:2===s?Tt:at("Unsupported field count: "+s))(o,n,r,e)}class At extends kt{constructor(t,e,n,r){super(n),this._op=e,this._fields=t,this._stream=!!r}init(){const t={count:0,valid:0,stream:this._stream};return this._op.forEach((e=>e.init(t))),t.values&&(t.list=new Et),t}write(t,e,n){const r=this._outputs,o=r.length;for(let s=0;s<o;++s)e[r[s].output][n]=r[s].value(t);return 1}_add(){}_rem(){}add(t){++t.count}rem(t){--t.count}}class Ct extends At{constructor(t,e,n,r){super(t,e,n,r);const o=["state","v1","v2"];this._add=St(e,o,"add"),this._rem=St(e,o,"rem")}add(t,e,n){const r=this._fields[0](e,n);++t.count,w(r)&&(++t.valid,t.list&&t.list.add(r),this._add(t,r))}rem(t,e,n){const r=this._fields[0](e,n);--t.count,w(r)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r))}}class Tt extends At{constructor(t,e,n,r){super(t,e,n,r);const o=["state","v1","v2"];this._add=St(e,o,"add"),this._rem=St(e,o,"rem")}add(t,e,n){const r=this._fields[0](e,n),o=this._fields[1](e,n);++t.count,w(r)&&w(o)&&(++t.valid,t.list&&t.list.add([r,o]),this._add(t,r,o))}rem(t,e,n){const r=this._fields[0](e,n),o=this._fields[1](e,n);--t.count,w(r)&&w(o)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r,o))}}function zt(t,e,n){if(e.length){const r=t.data(),{keys:o}=t.groups()||{},s=Dt(t,e),a=o?(t,e)=>s[t][o[e]]:t=>s[t][0];n=n.map((t=>e=>t(e,r,a)))}return n}function Dt(t,e,n){if(!e.length)return n;const r=Ut(e),o=t.groups(),s=o?o.size:1;return n=n||ut(e.length,(()=>Array(s))),s>1?r.forEach((e=>{const r=Rt(t,e,o);for(let t=0;t<s;++t)e.write(r[t],n,t)})):r.forEach((e=>{const r=Ft(t,e);e.write(r,n,0)})),n}function Ut(t,e){const n=[],r={};for(const e of t){const t=e.fields.map((t=>t+"")).join(",");(r[t]||(r[t]=[])).push(e)}for(const t in r)n.push(Nt(r[t],e));return n}function Ft(t,e){const n=e.init(),r=t.data(),o=t.mask();if(t.isOrdered()){const o=t.indices(),s=o.length;for(let t=0;t<s;++t)e.add(n,o[t],r)}else if(o)for(let t=o.next(0);t>=0;t=o.next(t+1))e.add(n,t,r);else{const o=t.totalRows();for(let t=0;t<o;++t)e.add(n,t,r)}return n}function Rt(t,e,n){const{keys:r,size:o}=n,s=ut(o,(()=>e.init())),a=t.data();if(t.isOrdered()){const n=t.indices(),o=n.length;for(let t=0;t<o;++t){const o=n[t];e.add(s[r[o]],o,a)}}else if(t.isFiltered()){const n=t.mask();for(let t=n.next(0);t>=0;t=n.next(t+1))e.add(s[r[t]],t,a)}else{const n=t.totalRows();for(let t=0;t<n;++t)e.add(s[r[t]],t,a)}return s}function qt(t,e){const{get:n,names:r,rows:o,size:s}=e,a=r.length;for(let e=0;e<a;++e){const a=t.add(r[e],Array(s)),i=n[e];for(let t=0;t<s;++t)a[t]=i(o[t])}}function It(t){return p(t)?t:P(t)?t.entries():t?Object.entries(t):[]}const Pt="Identifier",Lt="Literal",Gt="MemberExpression",Jt="ObjectPattern",Ht="Property",Vt="Column",Wt="Dictionary",Bt="Op";function Yt(t,e,n,r){const o=n[t.type]||n.Default;if(o&&!1===o(t,e,r))return;const s=ne[t.type];s&&s(t,e,n)}const Qt=(t,e,n)=>{Yt(t.argument,e,n,t)},Zt=(t,e,n)=>{Yt(t.left,e,n,t),Yt(t.right,e,n,t)},Kt=(t,e,n)=>{Yt(t.test,e,n,t),Yt(t.consequent,e,n,t),t.alternate&&Yt(t.alternate,e,n,t)},Xt=(t,e,n)=>{ee(t.params,e,n,t),Yt(t.body,e,n,t)},te=(t,e,n)=>{Yt(t.callee,e,n,t),ee(t.arguments,e,n,t)},ee=(t,e,n,r)=>{t.forEach((t=>Yt(t,e,n,r)))},ne={TemplateLiteral:(t,e,n)=>{ee(t.expressions,e,n,t),ee(t.quasis,e,n,t)},MemberExpression:(t,e,n)=>{Yt(t.object,e,n,t),Yt(t.property,e,n,t)},CallExpression:te,NewExpression:te,ArrayExpression:(t,e,n)=>{ee(t.elements,e,n,t)},AssignmentExpression:Zt,AwaitExpression:Qt,BinaryExpression:Zt,LogicalExpression:Zt,UnaryExpression:Qt,UpdateExpression:Qt,ConditionalExpression:Kt,ObjectExpression:(t,e,n)=>{ee(t.properties,e,n,t)},Property:(t,e,n)=>{Yt(t.key,e,n,t),Yt(t.value,e,n,t)},ArrowFunctionExpression:Xt,FunctionExpression:Xt,FunctionDeclaration:Xt,VariableDeclaration:(t,e,n)=>{ee(t.declarations,e,n,t)},VariableDeclarator:(t,e,n)=>{Yt(t.id,e,n,t),Yt(t.init,e,n,t)},SpreadElement:(t,e,n)=>{Yt(t.argument,e,n,t)},BlockStatement:(t,e,n)=>{ee(t.body,e,n,t)},ExpressionStatement:(t,e,n)=>{Yt(t.expression,e,n,t)},IfStatement:Kt,ForStatement:(t,e,n)=>{Yt(t.init,e,n,t),Yt(t.test,e,n,t),Yt(t.update,e,n,t),Yt(t.body,e,n,t)},WhileStatement:(t,e,n)=>{Yt(t.test,e,n,t),Yt(t.body,e,n,t)},DoWhileStatement:(t,e,n)=>{Yt(t.body,e,n,t),Yt(t.test,e,n,t)},SwitchStatement:(t,e,n)=>{Yt(t.discriminant,e,n,t),ee(t.cases,e,n,t)},SwitchCase:(t,e,n)=>{t.test&&Yt(t.test,e,n,t),ee(t.consequent,e,n,t)},ReturnStatement:Qt,Program:(t,e,n)=>{Yt(t.body[0],e,n,t)}};function re(t){delete t.start,delete t.end,delete t.optional}function oe(t){re(t),delete t.object,delete t.property,delete t.computed,t.table||delete t.table}function se(t,e){return e&&e.type===t}const ae=(t,e)=>{const n=de[t.type];return n?n(t,e):at(`Unsupported expression construct: ${t.type}`)},ie=(t,e)=>"("+ae(t.left,e)+" "+t.operator+" "+ae(t.right,e)+")",ue=(t,e)=>"("+le(t.params,e)+")=>"+ae(t.body,e),ce=(t,e)=>ae(t.callee,e)+"("+le(t.arguments,e)+")",le=(t,e,n=",")=>t.map((t=>ae(t,e))).join(n),fe=t=>t.computed?`[${Y(t.name)}]`:`.${t.name}`,me=(t,e,n)=>{const r=t.table||"";return`data${r}${fe(t)}.${n}(${e.index}${r})`},de={Constant:t=>t.raw,Column:(t,e)=>t.array?((t,e)=>{const n=t.table||"";return`data${n}${fe(t)}[${e.index}${n}]`})(t,e):me(t,e,"at"),Dictionary:(t,e)=>me(t,e,"key"),Function:t=>`fn.${t.name}`,Parameter:t=>`$${fe(t)}`,Op:(t,e)=>`op(${Y(t.name)},${e.op||e.index})`,Literal:t=>t.raw,Identifier:t=>t.name,TemplateLiteral:(t,e)=>{const{quasis:n,expressions:r}=t,o=r.length;let s=n[0].value.raw;for(let t=0;t<o;)s+="${"+ae(r[t],e)+"}"+n[++t].value.raw;return"`"+s+"`"},MemberExpression:(t,e)=>{const n=!t.computed,r=ae(t.object,e),o=ae(t.property,e);return r+(n?"."+o:"["+o+"]")},CallExpression:ce,NewExpression:(t,e)=>"new "+ce(t,e),ArrayExpression:(t,e)=>"["+le(t.elements,e)+"]",AssignmentExpression:ie,BinaryExpression:ie,LogicalExpression:ie,UnaryExpression:(t,e)=>"("+t.operator+ae(t.argument,e)+")",ConditionalExpression:(t,e)=>"("+ae(t.test,e)+"?"+ae(t.consequent,e)+":"+ae(t.alternate,e)+")",ObjectExpression:(t,e)=>"({"+le(t.properties,e)+"})",Property:(t,e)=>{const n=ae(t.key,e);return(t.computed?`[${n}]`:n)+":"+ae(t.value,e)},ArrowFunctionExpression:ue,FunctionExpression:ue,FunctionDeclaration:ue,ArrayPattern:(t,e)=>"["+le(t.elements,e)+"]",ObjectPattern:(t,e)=>"{"+le(t.properties,e)+"}",VariableDeclaration:(t,e)=>t.kind+" "+le(t.declarations,e,","),VariableDeclarator:(t,e)=>ae(t.id,e)+"="+ae(t.init,e),SpreadElement:(t,e)=>"..."+ae(t.argument,e),BlockStatement:(t,e)=>"{"+le(t.body,e,";")+";}",BreakStatement:()=>"break",ExpressionStatement:(t,e)=>ae(t.expression,e),IfStatement:(t,e)=>"if ("+ae(t.test,e)+")"+ae(t.consequent,e)+(t.alternate?" else "+ae(t.alternate,e):""),SwitchStatement:(t,e)=>"switch ("+ae(t.discriminant,e)+") {"+le(t.cases,e,"")+"}",SwitchCase:(t,e)=>(t.test?"case "+ae(t.test,e):"default")+": "+le(t.consequent,e,";")+";",ReturnStatement:(t,e)=>"return "+ae(t.argument,e),Program:(t,e)=>ae(t.body[0],e)};function he(t,e={index:"row"}){return ae(t,e)}function pe(t,e,n){return t=`"use strict"; return ${t};`,Function("fn","$",t)(e,n)}const ge={escape:(t,e,n)=>pe(t,e,n),expr:(t,e)=>pe(`(row,data,op)=>${t}`,V,e),expr2:(t,e)=>pe(`(row0,data0,row,data)=>${t}`,V,e),join:(t,e)=>pe(`(row1,data1,row2,data2)=>${t}`,V,e),param:(t,e)=>pe(t,V,e)},ve={"==":1,"!=":1,"===":1,"!==":1};function ye(t,e,n=0,r=void 0,o=void 0){if(t.type=Vt,t.name=e,t.table=n,y(r)&&(t.array=!0),o&&r&&it(r.keyFor)){const e=ve[o.operator]?o.left===t?o.right:o.left:o.callee&&"equal"===o.callee.name?o.arguments[o.arguments[0]===t?1:0]:null;e&&e.type===Lt&&function(t,e,n,r){r<0?(t.type=Lt,t.value=!1,t.raw="false"):(e.type=Wt,n.value=r,n.raw=r+"")}(o,t,e,r.keyFor(e.value))}return t}const _e="row_object";function we(t,e,n=e.columnNames()){t.type="ObjectExpression";const r=t.properties=[];for(const t of It(n)){const[n,o]=p(t)?t:[t,t];r.push({type:Ht,key:{type:Lt,raw:Y(o)},value:ye({computed:!0},n,0,e.column(n))})}return t}function be(t,e){return he(we({},t,e))}function xe(t,e){return ge.expr(be(t,e))}function $e(t,e,n){t.aggronly&&at("Escaped functions are not valid as rollup or pivot values.");const r=`(row,data)=>fn(${be(t.table)},$)`;return{escape:ge.escape(r,(o=e.expr,it(o)?o:()=>o),n)};var o}const Me={undefined:"void(0)",Infinity:"Number.POSITIVE_INFINITY",NaN:"Number.NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"};function Oe(t){return"number"==typeof t}const je={ecmaVersion:11},Ee=t=>(e,n)=>n.error(e,t+" not allowed"),ke=Ee("Aggregate function"),Se=Ee("Window function"),Ne="Invalid column reference",Ae=Ne+" (must be input to an aggregate function)",Ce="Invalid function call",Te="Invalid operator parameter",ze="Table expressions do not support closures",De="Use aq.escape(fn) to use a function as-is (including closures)",Ue=`\nNote: ${ze}. ${De}, or use table.params({ name: value }) to define dynamic parameters.`,Fe=`\nNote: ${ze}. ${De}, or use aq.addFunction(name, fn) to add new op functions.`,Re=`The ${_e} method is not valid in multi-table expressions.`;function qe(e,n){const r=function(e){try{const n=e.field?function(t){const e=JSON.stringify(t+"");return t.table?`(a,b)=>b[${e}]`:`d=>d[${e}]`}(e):p(e)?Y(e):e;return t(`expr=(${n})`,je).body[0].expression.right}catch(t){at("Expression parse error: "+(e+""))}}(n);let o=e.root=r;return e.spec=n,e.tuple=null,e.tuple1=null,e.tuple2=null,e.$param=null,e.$op=0,e.scope=new Set,e.paramsRef=new Map,e.columnRef=new Map,!function(t){return se("FunctionExpression",t)||se("ArrowFunctionExpression",t)}(o)?e.join?(e.scope.add(e.tuple1="d1"),e.scope.add(e.tuple2="d2"),e.scope.add(e.$param="$")):(e.scope.add(e.tuple="d"),e.scope.add(e.$param="$")):(!function(t,e){t.generator&&Ee("Generator functions")(t,e);t.async&&Ee("Async functions")(t,e);const{params:n}=t,r=n.length,o=t=>(n,r)=>e.columnRef.set(n,[r,t]),s=(t,n)=>e.paramsRef.set(t,n);r&&(e.join?(Ge(e,n[0],"tuple1",o(1)),r>1&&Ge(e,n[1],"tuple2",o(2)),r>2&&Ge(e,n[2],"$param",s)):(Ge(e,n[0],"tuple",o(0)),r>1&&Ge(e,n[1],"$param",s)));e.root=t.body}(o,e),o=o.body),Yt(o,e,Ie),e.root}const Ie={FunctionDeclaration:Ee("Function definitions"),ForStatement:Ee("For loops"),ForOfStatement:Ee("For-of loops"),ForInStatement:Ee("For-in loops"),WhileStatement:Ee("While loops"),DoWhileStatement:Ee("Do-while loops"),AwaitExpression:Ee("Await expressions"),ArrowFunctionExpression:Ee("Function definitions"),AssignmentExpression:Ee("Assignments"),FunctionExpression:Ee("Function definitions"),NewExpression:Ee('Use of "new"'),UpdateExpression:Ee("Update expressions"),VariableDeclarator(t,e){Xe(t.id,e)},Identifier(t,e,n){Ve(t,e,n)&&!e.scope.has(t.name)&&e.error(t,"Invalid variable reference",Ue)},CallExpression(t,e){const n=Je(t.callee),r=bt(n)||xt(n);if(r){if((e.join||!1===e.aggregate)&&yt(n)&&ke(t,e),(e.join||!1===e.window)&&_t(n)&&Se(t,e),e.$op=1,e.ast)Ke(t,n,e),t.arguments.forEach((t=>Yt(t,e,Le)));else{const o=e.op(function(t,e,n,r){const o=[],s=[],a=e.param[0]||0,i=a+(e.param[1]||0);return r.forEach(((e,n)=>{n<a?(Yt(e,t,Le),o.push(t.field(e))):n<i?(Yt(e,t,Le),s.push(t.param(e))):t.error(e,Te)})),{name:n,fields:o,params:s,...t.spec.window||{}}}(e,r,n,t.arguments));Object.assign(t,{type:"Op",name:o.id})}return e.$op=0,!1}wt(n)?Ke(t,n,e):e.error(t,Ce,Fe)},MemberExpression(t,e,n){const{object:r,property:o}=t;if(!se(Pt,r))return;const{name:s}=r;if(He(t)&&se(Pt,o)&&Object.hasOwn(Me,o.name))return void Ze(t,o.name);const a=s===e.tuple?0:s===e.tuple1?1:s===e.tuple2?2:-1;return a>=0?Pe(t,a,e,We,n):s===e.$param?Pe(t,a,e,Ye):void(e.paramsRef.has(s)?Qe(t,e.paramsRef.get(s)):e.columnRef.has(s)?Be(r,s,e,t):Object.hasOwn(e.params,s)&&Qe(r,s))}};function Pe(t,e,n,r,o){const{property:s,computed:a}=t;let i;if(a)if(se(Lt,s))i=s.value;else try{Yt(s,n,Ie,t),i=n.param(s)}catch(e){n.error(t,"Invalid member expression")}else i=s.name;return r(t,i,e,n,o),!1}const Le={...Ie,VariableDeclarator:Ee("Variable declaration in operator call"),Identifier(t,e,n){Ve(t,e,n)&&e.error(t,"Variable not accessible in operator call")},CallExpression(t,e){const n=Je(t.callee);wt(n)?Ke(t,n,e):e.error(t,Ce,Fe)}};function Ge(t,e,n,r){se(Pt,e)?(t.scope.add(e.name),t[n]=e.name):se(Jt,e)&&e.properties.forEach((e=>{const n=se(Pt,e.key)?e.key.name:se(Lt,e.key)?e.key.value:t.error(e,"Invalid argument");se(Pt,e.value)||t.error(e.value,"Unsupported destructuring pattern"),r(e.value.name,n)}))}function Je(t){return se(Pt,t)?t.name:se(Gt,t)?He(t)?function(t){return"max"===t?"greatest":"min"===t?"least":t}(t.property.name):t.property.name:null}function He(t){return se(Pt,t.object)&&"Math"===t.object.name}function Ve(t,e,n){const{name:r}=t;if(se(Gt,n)&&n.property===t);else if(se(Ht,n)&&n.key===t);else if(e.paramsRef.has(r))Qe(t,e.paramsRef.get(r));else if(e.columnRef.has(r))Be(t,r,e,n);else if(Object.hasOwn(e.params,r))Qe(t,r);else{if(!Object.hasOwn(Me,r))return!0;Ze(t,r)}}function We(t,e,n,r,o){const s=0===n?r.table:n>0?r.join[n-1]:null,a=s&&s.column(e);s&&!a&&r.error(t,Ne),r.aggronly&&!r.$op&&r.error(t,Ae),ye(t,e,n,a,o)}function Be(t,e,n,r){const[o,s]=n.columnRef.get(e);We(t,o,s,n,r)}function Ye(t,e,n,r){r.params&&!Object.hasOwn(r.params,e)&&r.error(t,"Invalid param reference"),Qe(t,e)}function Qe(t,e){t.type="Parameter",t.name=e}function Ze(t,e){t.type="Constant",t.name=e,t.raw=Me[e]}function Ke(t,e,n){if(e===_e){const e=n.table;e||n.error(t,Re),we(t,e,t.arguments.length?t.arguments.map((t=>{const r=n.param(t),o=Oe(r)?e.columnName(r):r;return e.column(o)||n.error(t,Ne),o})):e.columnNames())}else t.callee={type:"Function",name:e}}function Xe(t,e){se(Pt,t)?e.scope.add(t.name):se("ArrayPattern",t)?t.elements.forEach((t=>Xe(t,e))):se(Jt,t)?t.properties.forEach((t=>Xe(t.value,e))):e.error(t.id,"Unsupported variable declaration")}const tn={[Vt]:1,[Bt]:1};function en(t,e={}){const n=e.generate||he,r=e.compiler||ge,o=function(t){return(t.table?nn(t.table):t.join?{...nn(t.join[1]),...nn(t.join[0])}:{})||{}}(e),s={},a={},i=[],u=[];let c=0,f=-1;const m=e.join?r.join:1==e.index?r.expr2:r.expr,d={op(t){const e=function(t){let e=`${t.name}(${t.fields.concat(t.params).join(",")})`;if(t.frame){e+=`[${t.frame.map((t=>Number.isFinite(t)?Math.abs(t):-1))},${!!t.peers}]`}return e}(t);return a[e]||(t.id=++f,a[e]=t)},field(t){const e=n(t);return s[e]||(s[e]=++c)},param:t=>se(Lt,t)?t.value:r.param(n(t),o),value(t,r){i.push(t);const s=r.escape||(e.ast?(Yt(a=r,null,{Column:oe,Constant:oe,Default:re}),a):m(n(r),o));var a;u.push(s),tn[r.type]&&s!==r&&l(s)&&(s.field=r.name)},error(t,e,n=""){const r=t.start-6,o=t.end-6;at(`${e}: "${String(d.spec).slice(r,o)}"${n}`)}};Object.assign(d,e,{params:o});for(const[e,n]of It(t))d.value(e+"",n.escape?$e(d,n,o):qe(d,n));if(e.ast)return{names:i,exprs:u};const h=[];for(const t in s)h[s[t]]=r.expr(t,o);const p=Object.values(a);return p.forEach((t=>t.fields=t.fields.map((t=>h[t])))),{names:i,exprs:u,ops:p}}function nn(t){return t&&it(t.params)?t.params():{}}function rn(t,e){return t&&t.expr?new on({...t,...e}):new on(e,t)}class on{constructor(t,e){this.expr=e,Object.assign(this,t)}toString(){return String(this.expr)}toObject(){return{...this,expr:this.toString(),...it(this.expr)?{func:!0}:{}}}}function sn(t,e,n=0){const r=n?{field:!0,table:n}:{field:!0};return rn(t,e?{expr:e,...r}:r)}function an(t,e){for(const[n,r]of It(e))t.set(n,r);return t}function un(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function cn(t,e,n=new Map){return _(e=Oe(e)?t.columnName(e):e)?n.set(e,e):p(e)?e.forEach((e=>cn(t,e,n))):it(e)?cn(t,e(t),n):l(e)?an(n,e):at(`Invalid column selection: ${Y(e)}`),n}function ln(t,e){return t.toObject=e,t}function fn(t){return p(t)?t.map(fn):t&&t.toObject?t.toObject():t}function mn(){return ln((t=>t.columnNames()),(()=>({all:[]})))}function dn(...t){return t=t.flat(),ln((e=>{const n=cn(e,t);return e.columnNames((t=>!n.has(t)))}),(()=>({not:fn(t)})))}function hn(t,e){return ln((n=>{let r=Oe(t)?t:n.columnIndex(t),o=Oe(e)?e:n.columnIndex(e);if(o<r){const t=o;o=r,r=t}return n.columnNames().slice(r,o+1)}),(()=>({range:[t,e]})))}function pn(t){return _(t)&&(t=RegExp(un(t))),ln((e=>e.columnNames((e=>t.test(e)))),(()=>({matches:[t.source,t.flags]})))}function gn(t){return pn(RegExp("^"+un(t)))}function vn(t){return pn(RegExp(un(t)+"$"))}function yn(t,e,n,r={window:!1}){const o=new Map,s=n=>{_(n=Oe(n)?e.columnName(n):n)?o.set(n,sn(n)):it(n)?cn(e,n).forEach(s):l(n)?an(o,n):at(`Invalid ${t} value: ${n+""}`)};return W(n).forEach(s),r.preparse&&r.preparse(o),en(o,{table:e,...r})}function _n(t,...e){return function(t,e){return t.create({groups:wn(t,e)})}(t,yn("groupby",t,e.flat()))}function wn(t,{names:e=[],exprs:n=[],ops:r=[]}){const o=e.length;if(0===o)return null;if(1===o&&!t.isFiltered()&&n[0].field){const r=t.column(n[0].field);if(r.groups)return r.groups(e)}let s=zt(t,r,n);const a=lt(s),i=t.totalRows(),u=new Uint32Array(i),c={},l=[],f=t.data(),m=t.mask();if(m)for(let t=m.next(0);t>=0;t=m.next(t+1)){const e=a(t,f)+"";u[t]=c[e]??=l.push(t)-1}else for(let t=0;t<i;++t){const e=a(t,f)+"";u[t]=c[e]??=l.push(t)-1}return r.length||(s=s.map((t=>e=>t(e,f)))),{keys:u,get:s,names:e,rows:l,size:l.length}}function bn(t){return t?new xn({...t.data()},t.columnNames()):new xn}class xn{constructor(t,e){this.data=t||{},this.names=e||[]}add(t,e){return this.has(t)||this.names.push(t+""),this.data[t]=e}has(t){return Object.hasOwn(this.data,t)}groupby(t){return this.groups=t,this}new(t){const{data:e,names:n,groups:r=null}=this;return t.create({data:e,names:n,groups:r,filter:null,order:null})}derive(t){return t.create(this)}}function $n(t,e){return Mn(t,en(e,{table:t,aggronly:!0,window:!1}))}function Mn(t,{names:e,exprs:n,ops:r=[]}){const o=bn(),s=t.groups();return s&&qt(o,s),function(t,e,n,r=[],o){if(!e.length)return;const s=n?n.size:1,a=(t,e)=>r[t][e],i=t.length;for(let n=0;n<i;++n){const i=e[n];if(null!=i.field)o.add(t[n],r[i.field]);else if(s>1){const e=o.add(t[n],Array(s));for(let t=0;t<s;++t)e[t]=i(t,null,a)}else o.add(t[n],[i(0,null,a)])}}(e,n,s,Dt(t,r),o),o.new(t)}function On(t,...e){return jn(t,cn(t,e.flat()))}function jn(t,e){const n=bn();return e.forEach(((e,r)=>{const o=_(e)?e:r;if(o){const e=t.column(r)||at(`Unrecognized column: ${r}`);n.add(o,e)}})),n.derive(t)}function En(t,e,n,r){const o="map"===r||!0===r?nt:"entries"===r?ot:"object"===r?rt:at('groups option must be "map", "entries", or "object".'),{names:s}=t.groups(),a=function(t,e){t=L(t)?t:new Set(t);let n=e,r=0;for(;t.has(n);)n=e+ ++r;return n}(t.columnNames(),"_");let i=On(t,{}).reify(e).create({data:{[a]:n}});i=$n(i,{[a]:tt(a)});for(let t=s.length;--t>=0;)i=$n(_n(i,s.slice(0,t)),{[a]:o(s[t],a)});return i.get(a)}class kn{constructor(t,e,n,r,o,s){const a=Object.freeze({...t}),i=(e=e?.slice()??Object.keys(a)).length?a[e[0]].length:0;this._names=Object.freeze(e),this._data=a,this._total=i,this._nrows=n?.count()??i,this._mask=n??null,this._group=r??null,this._order=o??null,this._params=s,this._index=null,this._partitions=null}create({data:t,names:e,filter:n,groups:r,order:o}={}){const s=void 0!==n?n:this.mask();return new this.constructor(t||this._data,e||(t?null:this._names),s,void 0!==r?r:function(t,e){if(!t||!e)return t;const{keys:n,rows:r,size:o}=t,s=new Uint32Array(o);e.scan((t=>s[n[t]]=1));const a=s.reduce(((t,e)=>t+e),0);if(a===o)return t;const i=Array(a);let u=0;for(let t=0;t<o;++t)s[t]&&(i[s[t]=u++]=r[t]);const c=new Uint32Array(n.length);return e.scan((t=>c[t]=s[n[t]])),{...t,keys:c,rows:i,size:u}}(this._group,n&&s),void 0!==o?o:this._order,this._params)}params(t){return arguments.length?(t&&(this._params={...this._params,...t}),this):this._params}get[Symbol.toStringTag](){if(!this._names)return"Object";const t=this.numRows(),e=this.numCols(),n=t=>1!==t?"s":"";return`Table: ${e} col${n(e)} x ${t} row${n(t)}`+(this.isFiltered()?` (${this.totalRows()} backing)`:"")+(this.isGrouped()?`, ${this._group.size} groups`:"")+(this.isOrdered()?", ordered":"")}isFiltered(){return!!this._mask}isGrouped(){return!!this._group}isOrdered(){return!!this._order}data(){return this._data}mask(){return this._mask}groups(){return this._group}comparator(){return this._order}totalRows(){return this._total}numRows(){return this._nrows}get size(){return this._nrows}numCols(){return this._names.length}columnNames(t){return t?this._names.filter(t):this._names.slice()}columnName(t){return this._names[t]}columnIndex(t){return this._names.indexOf(t)}column(t){return this._data[t]}columnAt(t){return this._data[this._names[t]]}array(t,e=Array){const n=this.column(t),r=new e(this.numRows());let o=-1;return this.scan((t=>r[++o]=n.at(t)),!0),r}get(t,e=0){const n=this.column(t);return this.isFiltered()||this.isOrdered()?n.at(this.indices()[e]):n.at(e)}getter(t){const e=this.column(t),n=this.isFiltered()||this.isOrdered()?this.indices():null;return n?t=>e.at(n[t]):e?t=>e.at(t):void at(`Unrecognized column: ${t}`)}object(t=0){return Sn(this)(t)}objects(t={}){const{grouped:e,limit:n,offset:r}=t,o=xe(this,cn(this,t.columns||mn())),s=[];if(this.scan(((t,e)=>s.push(o(t,e))),!0,n,r),e&&this.isGrouped()){const t=[];return this.scan((e=>t.push(e)),!0,n,r),En(this,t,s,e)}return s}*[Symbol.iterator](){const t=Sn(this),e=this.numRows();for(let n=0;n<e;++n)yield t(n)}*values(t){const e=this.getter(t),n=this.numRows();for(let t=0;t<n;++t)yield e(t)}print(t={}){const e=Oe(t)?{limit:+t}:{...t,limit:10},n=this.objects({...e,grouped:!1}),r=`${this[Symbol.toStringTag]}. Showing ${n.length} rows.`;return console.log(r),console.table(n),this}indices(t=!0){if(this._index)return this._index;const e=this.numRows(),n=new Uint32Array(e),r=this.isOrdered(),o=this.mask();let s=-1;if(o)for(let t=o.next(0);t>=0;t=o.next(t+1))n[++s]=t;else for(let t=0;t<e;++t)n[++s]=t;if(t&&r){const{_order:t,_data:e}=this;n.sort(((n,r)=>t(n,r,e)))}return!t&&r||(this._index=n),n}partitions(t=!0){if(this._partitions)return this._partitions;if(!this.isGrouped())return[this.indices(t)];const{keys:e,size:n}=this._group,r=ut(n,(()=>[])),o=this._index,s=this.mask(),a=this.numRows();if(o&&this.isOrdered())for(let t,n=0;n<a;++n)t=o[n],r[e[t]].push(t);else if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))r[e[t]].push(t);else for(let t=0;t<a;++t)r[e[t]].push(t);if(t&&!o&&this.isOrdered()){const t=this._order,e=this._data;for(let o=0;o<n;++o)r[o].sort(((n,r)=>t(n,r,e)))}return!t&&this.isOrdered()||(this._partitions=r),r}reify(t){const e=t?t.length:this.numRows(),n=this._names;let r,o;if(!t&&!this.isOrdered()){if(!this.isFiltered())return this;e===this.totalRows()&&(r=this.data())}if(!r){const a=t?e=>t.forEach(e):t=>this.scan(t,!0),i=n.length;r={};for(let t=0;t<i;++t){const o=n[t],i=this.column(o),u=r[o]=new(v(s=i)?s.constructor:Array)(e);let c=-1;y(i)?a((t=>u[++c]=i[t])):a((t=>u[++c]=i.at(t)))}this.isGrouped()&&(o=function(t,e,n,r){const{keys:o,rows:s,size:a}=t;let i=s,u=a,c=null;if(n){c=new Int32Array(a),e((t=>c[o[t]]=1));const t=c.reduce(((t,e)=>t+e),0);if(t!==a){i=Array(t),u=0;for(let t=0;t<a;++t)c[t]&&(i[c[t]=u++]=s[t])}}let l=-1;const f=new Uint32Array(r);return e(u!==a?t=>f[++l]=c[o[t]]:t=>f[++l]=o[t]),{...t,keys:f,rows:i,size:u}}(this.groups(),a,!!t,e))}var s;return this.create({data:r,names:n,groups:o,filter:null,order:null})}scan(t,e,n=1/0,r=0){const o=this._mask,s=this._nrows,a=this._data;let i=r||0;if(i>s)return;const u=Math.min(s,i+n),c=()=>i=this._total;if(e&&this.isOrdered()||o&&this._index){const e=this.indices(),n=this._data;for(;i<u;++i)t(e[i],n,c)}else if(o){let e=u-i+1;for(i=o.nth(i);--e&&i>-1;i=o.next(i+1))t(i,a,c)}else for(;i<u;++i)t(i,a,c)}}function Sn(t){let e=t._builder;if(!e){const n=xe(t),r=t.data();if(t.isOrdered()||t.isFiltered()){const o=t.indices();e=t=>n(o[t],r)}else e=t=>n(t,r);t._builder=e}return e}function Nn(t,...e){e=e.flat();const n=t.numRows(),r=n+e.reduce(((t,e)=>t+e.numRows()),0);if(n===r)return t;const o=[t,...e],s=bn();return t.columnNames().forEach((t=>{const e=Array(r);let n=0;o.forEach((r=>{const o=r.column(t)||{at:()=>h};r.scan((t=>e[n++]=o.at(t)))})),s.add(t,e)})),s.new(t)}function An(t,e,{before:n,after:r}={}){const o=null!=n,s=null!=r;o||s||at("relocate requires a before or after option."),o&&s&&at("relocate accepts only one of the before or after options."),e=cn(t,e);const a=[...cn(t,o?n:r).keys()],i=o?a[0]:a.pop(),u=new Map;return t.columnNames().forEach((t=>{const n=!e.has(t);if(t===i){s&&n&&u.set(t,t);for(const[t,n]of e)u.set(t,n);if(s)return}n&&u.set(t,t)})),jn(t,u)}function Cn(t){return{left(e,n,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const s=r+o>>>1;t(e[s],n)<0?r=s+1:o=s}return r},right(e,n,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const s=r+o>>>1;t(e[s],n)>0?o=s:r=s+1}return r}}}const Tn=Cn(Ot);function zn(t,e,n,r={},o){const s=t.data(),a=function(t,e){const n={};return t.forEach((t=>{const e=(t=>(t.frame||[null,null]).map((t=>Number.isFinite(t)?Math.abs(t):null)))(t),r=(t=>!!t.peers)(t),o=`${e},${r}`,{aggOps:s,winOps:a}=n[o]||(n[o]={frame:e,peers:r,aggOps:[],winOps:[]});yt(t.name)?s.push(t):a.push(function(t){const{id:e,name:n,fields:r=[],params:o=[]}=t;return{...xt(n).create(...o),get:r.length?r[0]:null,id:e}}(t))})),Object.values(n).map((t=>function(t,e,n,r,o){let s,a,i,u,c;const l=t=>a[t-1]===a[t],f=r.length,m=o.length,d=r.length?Mt(["w","r","k"],"{"+$t(r,((t,e)=>`r[_${e}.id][k]=_${e}.value(w,_${e}.get);`))+"}",r):()=>{},h={i0:0,i1:0,index:0,size:0,peer:l,init(t,e,n,l){h.index=h.i0=h.i1=0,h.size=e.length,s=t,a=e,u=n,c=l,i=o?o.map((t=>t.init())):null;for(let t=0;t<f;++t)r[t].init();return h},value:(e,n)=>n(s[e],t),step(r){const[f,p]=e,g=h.size,v=h.i0,y=h.i1;h.i0=null!=f?Math.max(0,r-Math.abs(f)):0,h.i1=null!=p?Math.min(g,r+Math.abs(p)+1):g,h.index=r,n&&(h.i0>0&&l(h.i0)&&(h.i0=Tn.left(a,a[h.i0])),h.i1<g&&l(h.i1)&&(h.i1=Tn.right(a,a[h.i1-1])));for(let e=0;e<m;++e){const n=o[e],r=i[e];for(let e=v;e<h.i0;++e)n.rem(r,s[e],t);for(let e=y;e<h.i1;++e)n.add(r,s[e],t);n.write(r,u,c)}return d(h,u,c),u}};return h}(e,t.frame,t.peers,t.winOps,Ut(t.aggOps,null!=t.frame[0]?-1:1))))}(o,s),i=a.length,u=Mt(["r","d","op"],"{"+$t(e,((t,e)=>`_${e}[r] = $${e}(r, d, op);`))+"}",e,n);t.partitions().forEach(((e,n)=>{const o=e.length,c=function(t,e){if(t.isOrdered()){const n=t.comparator(),r=t.data(),o=e.length,s=new Uint32Array(o);for(let t=1,a=0;t<o;++t)s[t]=n(e[t-1],e[t],r)?++a:a;return s}return e}(t,e);for(let t=0;t<i;++t)a[t].init(e,c,r,n);const l=t=>r[t][n];for(let t=0;t<o;++t){for(let e=0;e<i;++e)a[e].step(t);u(e[t],s,l)}}))}function Dn(t){return _t(t.name)||t.frame&&(Number.isFinite(t.frame[0])||Number.isFinite(t.frame[1]))}function Un(t,{names:e,exprs:n,ops:r=[]},o={}){const s=t.totalRows(),a=bn(o.drop?null:t),i=e.map((t=>a.add(t,Array(s)))),[u,c]=function(t){const e=[],n=[],r=t.length;for(let o=0;o<r;++o){const r=t[o];r.id=o,(Dn(r)?n:e).push(r)}return[e,n]}(r),l=t.isGrouped()?t.groups().size:1,f=Dt(t,u,ut(r.length,(()=>Array(l))));return c.length?zn(t,i,n,f,c):function(t,e,n,r){const o=t.mask(),s=t.data(),{keys:a}=t.groups()||{},i=a?(t,e)=>r[t][a[e]]:t=>r[t][0],u=e.length;for(let r=0;r<u;++r){const a=n[r],u=e[r];if(o)for(let t=o.next(0);t>=0;t=o.next(t+1))u[t]=a(t,s,i);else{const e=t.totalRows();for(let t=0;t<e;++t)u[t]=a(t,s,i)}}}(t,i,n,f),a.derive(t)}function Fn(t,e){const n=en({p:e},{table:t});let r=n.exprs[0];if(n.ops.length){const e=Un(t,n,{drop:!0}).column("p");r=t=>e.at(t)}return function(t,e){const n=t.totalRows(),r=t.mask(),o=t.data(),s=new i(n);if(r)for(let t=r.next(0);t>=0;t=r.next(t+1))e(t,o)&&s.set(t);else for(let t=0;t<n;++t)e(t,o)&&s.set(t);return t.create({filter:s})}(t,r)}function Rn(t,...e){return Fn(_n(t,(e=e.flat()).length?e:t.columnNames()),"row_number() === 1").ungroup().reify()}function qn(t,e){const n=new Map;return t.scan(((t,r)=>{const o=e(t,r);null!=o&&o==o&&n.set(o,t)})),n}function In(t,e,n){const r=new Map;W(n).forEach(((n,o)=>{_(n=Oe(n)?e.columnName(n):n)?r.set(o,sn(n)):it(n)||l(n)&&n.expr?r.set(o,n):at(`Invalid ${t} key value: ${n+""}`)}));return lt(en(r,{table:e,aggregate:!1,window:!1}).exprs,!0)}function Pn(t,e,n){if(n)_(n)?n=[n,n]:p(n)&&1===n.length&&(n=[n[0],n[0]]);else{const r=function(t,e){const n=new Set(e);return t.filter((t=>n.has(t)))}(t.columnNames(),e.columnNames());r.length||at("Natural join requires shared column names."),n=[r,r]}return n}function Ln(t,e,n,r){return n.length!==r.length&&at("Mismatched number of join keys"),[In("join",t,n),In("join",e,r)]}function Gn(t,e,n){return Hn(t,e,n,{anti:!1})}function Jn(t,e,n){return Hn(t,e,n,{anti:!0})}function Hn(t,e,n,r){return function(t,e,n,r={}){const o=new i(t.totalRows()),s=p(n)?Vn:Wn;s(o,t,e,n),r.anti&&o.not().and(t.mask());return t.create({filter:o})}(t,e,p(n=Pn(t,e,n))?Ln(t,e,...n.map(W)):en({on:n},{join:[t,e]}).exprs[0],r)}function Vn(t,e,n,[r,o]){const s=qn(n,o);e.scan(((e,n)=>{s.get(r(e,n))>=0&&t.set(e)}))}function Wn(t,e,n,r){const o=e.numRows(),s=n.numRows(),a=e.data(),i=n.data();if(e.isFiltered()||n.isFiltered()){const u=e.indices(!1),c=n.indices(!1);for(let e=0;e<o;++e){const n=u[e];for(let e=0;e<s;++e)if(r(n,a,c[e],i)){t.set(n);break}}}else for(let e=0;e<o;++e)for(let n=0;n<s;++n)if(r(e,a,n,i)){t.set(e);break}}function Bn(t,{names:e=[],exprs:n=[],ops:r=[]},o={}){if(!e.length)return t;const s=o.limit>0?+o.limit:1/0,a=o.index?!0===o.index?"index":o.index+"":null,i=new Set(o.drop),u=zt(t,r,n),c=bn(),l=new Set(e),f=[],m=[],d=[];t.columnNames().forEach((e=>{if(!i.has(e)){const n=c.add(e,[]);l.has(e)||(f.push(t.column(e)),m.push(n))}})),e.forEach((t=>{i.has(t)||(c.has(t)||c.add(t,[]),d.push(c.data[t]))}));const h=a?c.add(a,[]):null;let p=0;const g=f.length,v=d.length,y=(t,e)=>{for(let n=0;n<g;++n)m[n].length=p+e,m[n].fill(f[n].at(t),p,p+e)},_=h?(t,e)=>{for(let n=0;n<e;++n)h[t+n]=n}:()=>{};if(1===v){const e=u[0],n=d[0];t.scan(((t,r)=>{const o=W(e(t,r)),a=Math.min(o.length,s);y(t,a);for(let t=0;t<a;++t)n[p+t]=o[t];_(p,a),p+=a}))}else t.scan(((t,e)=>{let n=0;const r=u.map((r=>{const o=W(r(t,e));return n=Math.min(Math.max(n,o.length),s),o}));y(t,n);for(let t=0;t<v;++t){const e=d[t],o=r[t];for(let t=0;t<n;++t)e[p+t]=o[t]}_(p,n),p+=n}));return c.new(t)}function Yn(t,e,n){return function(t,{names:e=[],exprs:n=[],ops:r=[]},o={}){if(0===e.length)return t;const[s="key",a="value"]=o.as||[],i=zt(t,r,n);return Bn(t,{names:[s,a],exprs:[()=>e,(t,e)=>i.map((n=>n(t,e)))]},{...o,drop:e})}(t,yn("fold",t,e),n)}function Qn(t){return t.isGrouped()?t.create({groups:null}):t}function Zn(t){t.forEach(((e,n)=>e.field?t.set(n,et(e+"")):0))}function Kn(t,e,n,r){const o=n&&n.length;t=o?function(t,e,n){const r=t.groups(),o=t.data(),s=(r?r.names:[]).concat(e),a=(r?r.get:[]).concat(e.map((e=>t.getter(e)))),i=new Set,u=lt(a);t.scan(((t,e)=>i.add(u(t,e))));const c=t.columnNames(),l=bn(),f=c.map((t=>l.add(t,[])));c.forEach(((e,n)=>{const r=o[e],s=f[n];t.scan((t=>s.push(r.at(t))))}));const m=lt(a.map(((t,e)=>t=>t[e]))),d=Mt("v","{"+f.map(((t,e)=>`_${e}.push(v[$${e}]);`)).join("")+"}",f,c.map((t=>s.indexOf(t))));if(r){let t=r.keys.length;const e=n.reduce(((t,e)=>t*e.length),r.size),o=new Uint32Array(e+(t-i.size));o.set(r.keys),Xn(r,n,((e,n)=>{i.has(m(e))||(d(e),o[t++]=n[0])})),l.groupby({...r,keys:o})}else Xn(r,n,(t=>{i.has(m(t))||d(t)}));return l.new(t)}(t,n,r):t;const{names:s,exprs:a,ops:i}=e,u=zt(t,i,a),c=o?null:bn(t),l=t.totalRows();return s.forEach(((e,n)=>{const r=t.column(e),s=o?r:c.add(e,Array(l)),a=u[n];t.scan((t=>{const e=r.at(t);s[t]=w(e)?e:a(t)}))})),o?t:t.create(c)}function Xn(t,e,n){const r=t?t.get.length:0,o=t?1:0,s=o+e.length,a=new Int32Array(s),i=new Int32Array(s),u=[];if(t){const{get:e,rows:n,size:o}=t;a[0]=o,u.push(((t,o)=>{const s=n[o];for(let n=0;n<r;++n)t[n]=e[n](s)}))}e.forEach(((t,e)=>{const n=e+r;a[e+o]=t.length,u.push(((e,r)=>e[n]=t[r]))}));const c=Array(r+e.length);for(let t=0;t<s;++t)u[t](c,0);n(c,i);for(let t=s-1;t>=0;){const e=++i[t];e<a[t]?(u[t](c,e),n(c,i),t=s-1):(i[t]=0,u[t](c,0),--t)}}const tr={aggregate:!1,window:!1,index:1},er=-1/0;function nr(t,e,n,r,o={}){const s={join:[t,e]};let a;if(p(n=Pn(t,e,n))){const[s,i]=n.map(W);a=Ln(t,e,s,i),r||(r=function(t,e,n,r){const o=[];e.forEach(((t,e)=>_(t)&&t===n[e]?o.push(t):0));const s=dn(o);if(r.left&&r.right){const e=new Set(o);return[t.columnNames().map((t=>{const n=`[${Y(t)}]`;return e.has(t)?{[t]:`(a, b) => a${n} == null ? b${n} : a${n}`}:t})),s]}return r.right?[s,mn()]:[mn(),s]}(t,s,i,o))}else a=en({on:n},s).exprs[0],r||(r=[mn(),mn()]);return function(t,e,n,{names:r,exprs:o},s={}){const a=t.data(),i=t.indices(!1),u=i.length,c=new Int32Array(u),l=e.data(),f=e.indices(!1),m=f.length,d=new Int32Array(m),h=r.length,g=bn(),v=Array(h),y=Array(h);for(let t=0;t<r.length;++t)v[t]=g.add(r[t],[]),y[t]=o[t];const _=function(t,e){const n=["i","a","j","b"];return Mt(n,"{"+$t(t,((t,e)=>`_${e}.push($${e}(${n}));`))+"}",t,e)}(v,y),w=p(n)?sr:or;if(w(_,n,a,l,i,f,c,d,u,m),s.left)for(let t=0;t<u;++t)c[t]||_(i[t],a,er,l);if(s.right)for(let t=0;t<m;++t)d[t]||_(er,a,f[t],l);return g.new(t)}(t,e,a,function(t,e,n,r,o=[]){if(p(n)){let s,a,i,u=n.length;s=a=i={names:[],exprs:[]},u--&&(s=yn("join",t,n[0],r)),u--&&(a=yn("join",e,n[1],tr)),u--&&(i=en(n[2],r));const c=new Set,l=new Set(s.names);return a.names.forEach((t=>{l.has(t)&&c.add(t)})),c.size&&(""!==o[0]&&rr(s.names,c,o[0]||"_1"),""!==o[1]&&rr(a.names,c,o[1]||"_2")),{names:s.names.concat(a.names,i.names),exprs:s.exprs.concat(a.exprs,i.exprs)}}return en(n,r)}(t,e,r,s,o&&o.suffix),o)}function rr(t,e,n){t.forEach(((r,o)=>e.has(r)?t[o]=r+n:0))}function or(t,e,n,r,o,s,a,i,u,c){for(let l=0;l<u;++l){const u=o[l];for(let o=0;o<c;++o){const c=s[o];e(u,n,c,r)&&(t(u,n,c,r),a[l]=1,i[o]=1)}}}function sr(t,[e,n],r,o,s,a,i,u,c,l){let f,m,d,h,p,g,v,y,_=t;c>=l?(f=r,m=e,d=i,h=s,p=o,g=n,v=u,y=a):(f=o,m=n,d=u,h=a,p=r,g=e,v=i,y=s,_=(e,n,r,o)=>t(r,o,e,n));const w=function(t,e,n){const r=new Map,o=t.length;for(let s=0;s<o;++s){const o=n(t[s],e);null!=o&&o==o&&(r.has(o)?r.get(o).push(s):r.set(o,[s]))}return r}(y,p,g),b=h.length;for(let t=0;t<b;++t){const e=h[t],n=w.get(m(e,f));if(n){const r=n.length;for(let t=0;t<r;++t){const r=n[t];_(e,f,y[r],p),v[r]=1}d[t]=1}}}function ar(t,e,n,...r){return n=Pn(t,e,n),r=0===r.length?[dn(t.columnNames())]:r.flat(),function(t,e,[n,r],{names:o,exprs:s,ops:a=[]}){const i=bn(t),u=t.totalRows();o.forEach((t=>i.add(t,Array(u).fill(h))));const c=qn(e,r),l=Mt(["lr","rr","data"],"{"+$t(o,((t,e)=>`_[${e}][lr] = $[${e}](rr, data);`))+"}",o.map((t=>i.data[t])),zt(e,a,s)),f=e.data();return t.scan(((t,e)=>{const r=c.get(n(t,e));r>=0&&l(t,r,f)})),i.derive(t)}(t,e,[In("lookup",t,n[0]),In("lookup",e,n[1])],yn("lookup",e,r))}const ir=(t,e,n,r)=>`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n} : (u > v || v == null) && u != null ? ${r} : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n} : v !== v && u === u ? ${r} : `,ur=(t,e,n,r,o)=>`(v = ${e}, (u = ${t}) == null && v == null) ? 0 : v == null ? ${r} : u == null ? ${n} : (u = ${o}(u,v)) ? u : `;function cr(t,...e){return function(t,e){return t.create({order:e})}(t,function(t,e){let n=-1;const r=new Map,o=t=>r.set(++n+"",t);return e.forEach((e=>{const n=null!=e.expr?e.expr:e;if(l(n)&&!it(n))for(const t in n)o(n[t]);else o(Oe(n)?sn(e,t.columnName(n)):_(n)?sn(e):it(n)?e:at("Invalid orderby field: "+(e+"")))})),function(t,e){const n=[],r=[],o=[];let s=null,a="0",i="0";t.isGrouped()&&(s=t.groups().keys,a="ka",i="kb");const{ops:u}=en(e,{table:t,value:(t,e)=>{if(n.push(t),e.escape){const t=t=>`fn[${o.length}](${t}, data)`;r.push([t("a"),t("b")]),o.push(e.escape)}else r.push([he(e,{index:"a",op:a}),he(e,{index:"b",op:i})])},window:!1}),c=Dt(t,u),l=(t,e)=>c[t][e],f=n.length;let m="return (a, b) => {"+(l&&t.isGrouped()?"const ka = keys[a], kb = keys[b];":"")+"let u, v; return ";for(let t=0;t<f;++t){const s=e.get(n[t]),a=s.desc?-1:1,[i,u]=r[t];s.collate?(m+=ur(i,u,-a,a,`${a<0?"-":""}fn[${o.length}]`),o.push(s.collate)):m+=ir(i,u,-a,a)}return m+="0;};",Function("op","keys","fn","data",m)(l,s,o,t.data())}(t,r)}(t,e.flat()))}function lr(t,e,n,r){return function(t,e,n,r={}){const{keys:o,keyColumn:s}=function(t,e,n){const r=n.limit>0?+n.limit:1/0,o=mr(n.sort,!0),s=mr(n.keySeparator,"_"),a=zt(t,e.ops,e.exprs),i=1===a.length?a[0]:(t,e)=>a.map((n=>n(t,e))).join(s),u=Array(t.totalRows());t.scan(((t,e)=>u[t]=i(t,e)));const c=Dt(Qn(t),[{id:0,name:"array_agg_distinct",fields:[t=>u[t]],params:[]}])[0][0],l=o?c.sort():c;return{keys:Number.isFinite(r)?l.slice(0,r):l,keyColumn:u}}(t,e,r),a=mr(r.valueSeparator,"_"),i=n.names.length>1?(t,e)=>e+a+o[t]:t=>o[t],u=o.map((e=>Dt(t,n.ops.map((t=>{if("count"===t.name){const n=t=>e===s[t]?1:NaN;return n.toString=()=>e+":1",{...t,name:"sum",fields:[n]}}const n=t.fields.map((t=>{const n=(n,r)=>e===s[n]?t(n,r):NaN;return n.toString=()=>e+":"+t,n}));return{...t,fields:n}})))));return function({names:t,exprs:e},n,r,o){const s=r?r.size:1,a=bn(),i=o.length,u=t.length;let c;const l=(t,e)=>c[t][e];r&&qt(a,r);for(let r=0;r<u;++r){const u=e[r];if(null!=u.field)for(let e=0;e<i;++e)a.add(n(e,t[r]),o[e][u.field]);else if(s>1)for(let e=0;e<i;++e){c=o[e];const i=a.add(n(e,t[r]),Array(s));for(let t=0;t<s;++t)i[t]=u(t,null,l)}else for(let e=0;e<i;++e)c=o[e],a.add(n(e,t[r]),[u(0,null,l)])}return a}(n,i,t.groups(),u).new(t)}(t,yn("fold",t,e),yn("fold",t,n,{preparse:fr,window:!1,aggronly:!0}),r)}function fr(t){t.forEach(((e,n)=>e.field?t.set(n,K(e+"")):0))}const mr=(t,e)=>null!=t?t:e;function dr(t,e,n,r){return(e?r?pr:hr:r?vr:gr)(t.length,t,n,r)}function hr(t,e,n){const r=n.length;for(let o=0;o<t;++o)e[o]=n[r*R()|0];return e}function pr(t,e,n,r){const o=n.length,s=new Float64Array(o);let a=0;for(let t=0;t<o;++t)s[t]=a+=r(n[t]);const i=Cn(Ot).right;for(let r=0;r<t;++r)e[r]=n[i(s,a*R())];return e}function gr(t,e,n){const r=n.length;if(t>=r)return n;for(let r=0;r<t;++r)e[r]=n[r];for(let o=t;o<r;++o){const r=o*R();r<t&&(e[0|r]=n[o])}return e}function vr(t,e,n,r){const o=n.length;if(t>=o)return n;const s=new Float32Array(o),a=new Uint32Array(o);for(let t=0;t<o;++t)a[t]=t,s[t]=-Math.log(R())/r(n[t]);a.sort(((t,e)=>s[t]-s[e]));for(let r=0;r<t;++r)e[r]=n[a[r]];return e}function yr(t,e,n={}){return function(t,e,n,r={}){const{replace:o,shuffle:s}=r,a=t.partitions(!1);let i=0;e=a.map(((t,n)=>{let r=e(n);return i+=r=o?r:Math.min(t.length,r),r}));const u=new Uint32Array(i);let c=0;a.forEach(((t,r)=>{const s=e[r],a=u.subarray(c,c+=s);o||s!==t.length?dr(a,o,t,n):a.set(t)})),!1!==s&&(a.length>1||!o)&&function(t,e=0,n=t.length){let r=n-(e=+e);for(;r;){const n=R()*r--|0,o=t[r+e];t[r+e]=t[n+e],t[n+e]=o}}(u);return t.reify(u)}(t,function(t,e){return Oe(e)?()=>e:_r(Mn(t,en({size:e},{table:t,window:!1})).column("size"))}(t,e),function(t,e){return null==e?null:(e=Oe(e)?t.columnName(e):e,_r(_(e)?t.column(e):Un(t,en({w:e},{table:t}),{drop:!0}).column("w")))}(t,n.weight),n)}const _r=t=>e=>t.at(e)||0;function wr(t){return t<0?`count() + ${t}`:t}function br(t,e=0,n=1/0){if(t.isGrouped())return Fn(t,function(t=0,e=1/0){return`${wr(t)} < row_number() && row_number() <= ${wr(e)}`}(e,n)).reify();const r=[],o=t.numRows();return e=Math.max(0,e+(e<0?o:0)),n=Math.min(o,Math.max(0,n+(n<0?o:0))),t.scan((t=>r.push(t)),!0,n-e,e),t.reify(r)}function xr(t,e,n){return function(t,{names:e,exprs:n,ops:r=[]},o={}){if(0===e.length)return t;const s=1===e.length&&o.as||[],a=null==o.drop||!!o.drop,i=null==o.limit?s.length||1/0:Math.max(1,+o.limit||1),u=zt(t,r,n),c=bn(),l=e.reduce(((t,e,n)=>t.set(e,n)),new Map),f=(e,n)=>{const r=function(t,e,n){const r=t.totalRows(),o=[];return t.scan(((t,s)=>{const a=W(e(t,s)),i=Math.min(a.length,n);for(;o.length<i;)o.push(Array(r).fill(h));for(let e=0;e<i;++e)o[e][t]=a[e]})),o}(t,u[e],i),o=r.length;for(let t=0;t<o;++t)c.add(s[t]||`${n}_${t+1}`,r[t])};return t.columnNames().forEach((e=>{l.has(e)?(a||c.add(e,t.column(e)),f(l.get(e),e),l.delete(e)):c.add(e,t.column(e))})),l.forEach(f),c.derive(t)}(t,yn("spread",t,e),n)}function $r(t,e){return it(e)?e(t):e||t.columnNames()}function Mr(t,o={}){const{columns:s,limit:a=1/0,offset:i=0,types:u={},...c}=o,l=$r(t,s),f=t.data(),m=0===i&&t.numRows()<=a&&!t.isFiltered()&&!t.isOrdered();return e(l.map((e=>{const o=f[e],s=u[e],l=y(o);let d;if(m&&(l||it(o.toArray)))d=n(l?o:o.toArray(),s,c);else{const e=l?t=>o[t]:t=>o.at(t);d=r((n=>t.scan((t=>n(e(t))),!0,a,i)),s,c)}return[e,d]})))}function Or(t,e={}){const{format:n="stream",...r}=e;return o(Mr(t,r),{format:n})}function jr(t){return t}function Er(t,e,n=100,r,o){const{start:s=jr,cell:a,end:i=jr}=o,u=t.data(),c=e.length;t.scan((t=>{s(t);for(let n=0;n<c;++n){const r=e[n];a(u[r].at(t),r,n)}i(t)}),!0,n,r)}function kr(t,e={}){const n=$r(t,e.columns),r=e.format||{},o=e.delimiter||",",s=e.header??!0,a=new RegExp(`["${o}\n\r]`),i=t=>null==t?"":u(t)?E(t,!0):a.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t,c=n.map(i);let l=s?c.join(o)+"\n":"";return Er(t,n,e.limit||1/0,e.offset,{cell(t,e,n){c[n]=i(r[e]?r[e](t):t)},end(){l+=c.join(o)+"\n"}}),l}function Sr(t,e,n){const r=n.format||{},o=n.align||{},s={},a={};return e.forEach((e=>{const i=function(t,e={}){let n=0,r=0,o=0,s=0,a=0,i=0;return t((t=>{if(++n,null==t)return void++r;const e=typeof t;if("object"===e&&u(t))++o,0===(c=t).getUTCHours()&&0===c.getUTCMinutes()&&0===c.getUTCSeconds()&&0===c.getUTCMilliseconds()&&++s;else if("number"===e&&(++a,t==t&&(0|t)!==t)){const e=t+"",n=e.indexOf(".");if(n>=0){const t=e.indexOf("e"),r=t>0?t:e.length;i=Math.max(i,r-n-1)}}var c})),{align:(r+a+o)/n>.5?"r":"l",format:{utc:o===s,digits:Math.min(i,e.maxdigits||6)}}}(function(t,e){const n=t.column(e);return e=>t.scan((t=>e(n.at(t))))}(t,e),n);a[e]=o[e]||i.align,s[e]=r[e]||i.format})),{align:a,format:s}}function Nr(t,e={}){if(it(e))return e(t)+"";const n=typeof t;if("object"===n){if(u(t))return e.utc?E(t):j(t);{const n=JSON.stringify(t,((t,e)=>v(e)?Array.from(e):e)),r=e.maxlen||30;return n.length>r?n.slice(0,28)+"…"+("["===n[0]?"]":"}"):n}}if("number"===n){const n=e.digits||0;let r;return 0!==t&&((r=Math.abs(t))>=1e18||r<Math.pow(10,-n))?t.toExponential(n):t.toFixed(n)}return t+""}function Ar(t,e={}){const n=$r(t,e.columns),{align:r,format:o}=Sr(t,n,e),s=function(t){return function(t,e,n={}){for(const r in t)n[r]=e(t[r],r);return n}(t.style,(t=>it(t)?t:()=>t))}(e),a=e.null,i=(t,e)=>Nr(t,e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),u=a?(t,e)=>null==t?a(t):i(t,e):i;let c=-1,l=-1;const f=(t,e,n)=>{const o=n?(t=>"c"===t?"center":"r"===t?"right":"left")(r[e]):"",a=s[t]&&s[t](e,l,c)||"",i=(o?`text-align: ${o};`+(a?" ":""):"")+a;return`<${t}${i?` style="${i}"`:""}>`};let m=f("table")+f("thead")+f("tr",c)+n.map((t=>`${f("th",t,1)}${t}</th>`)).join("")+"</tr></thead>"+f("tbody");return Er(t,n,e.limit,e.offset,{start(t){c=t,++l,m+=f("tr")},cell(t,e){m+=f("td",e,1)+u(t,o[e])+"</td>"},end(){m+="</tr>"}}),m+"</tbody></table>"}const Cr={},Tr={},zr=10,Dr="columns",Ur="ndjson",Fr=t=>u(t)?E(t,!0):t;function Rr(t,{type:e,columns:n,format:r={},limit:o,offset:s}={}){const a=$r(t,n),i=a.map((t=>r[t]||Fr)),u=e=>t.scan(e,!0,o,s);return e===Dr?function(t,e,n,r){let o="{";return e.forEach(((e,s)=>{o+=(s?",":"")+JSON.stringify(e)+":[";const a=t.column(e),i=n[s];let u=-1;r((t=>{const e=a.at(t);o+=(++u?",":"")+JSON.stringify(i(e))})),o+="]"})),o+"}"}(t,a,i,u):function(t,e,n,r,o=!1){const s=e.length,a=e.map((t=>`"${t}":`)),i=e.map((e=>t.column(e))),u=o?t=>t.replaceAll("\n",""):jr,c=o?"\n":",";let l=o?"":"[",f=-1;return r((t=>{const e=[];for(let r=0;r<s;++r)e.push(a[r]+JSON.stringify(n[r](i[r].at(t))));l+=(++f?c:"")+u(`{${e.join(",")}}`)})),l+(o?"":"]")}(t,a,i,u,e===Ur)}function qr(t,e={}){const n=$r(t,e.columns),{align:r,format:o}=Sr(t,n,e),s=t=>t.replace(/\|/g,"\\|");let a="|"+n.map(s).join("|")+"|\n|"+n.map((t=>{return"c"===(e=r[t])?":-:":"r"===e?"-:":":-";var e})).join("|")+"|\n";return Er(t,n,e.limit,e.offset,{start(){a+="|"},cell(t,e){a+=s(Nr(t,o[e]))+"|"},end(){a+="\n"}}),a}class Ir extends kn{assign(...t){return function(t,...e){e=e.flat();const n=t.numRows(),r=t.reify(),o=bn(r).groupby(r.groups());return e.forEach((t=>{(t=t instanceof kn?t:new kn(t)).numRows()!==n&&at("Assign row counts do not match"),(t=t.reify()).columnNames((e=>o.add(e,t.column(e))))})),o.new(t)}(this,...t)}count(t={}){const{as:e="count"}=t;return $n(this,{[e]:X()})}derive(t,e){return function(t,e,n={}){const r=Un(t,en(e,{table:t}),n);return n.drop||null==n.before&&null==n.after?r:An(r,Object.keys(e).filter((e=>!t.column(e))),n)}(this,t,e)}filter(t){return Fn(this,t)}slice(t,e){return br(this,t,e)}groupby(...t){return _n(this,...t)}orderby(...t){return cr(this,...t)}relocate(t,e){return An(this,W(t),e)}rename(...t){return function(t,...e){const n=new Map;return t.columnNames((t=>(n.set(t,t),0))),jn(t,cn(t,e.flat(),n))}(this,...t)}reduce(t){return function(t,e){const n=bn(),r=t.groups(),{get:o,names:s=[],rows:a,size:i=1}=r||{},u=new Uint32Array(i+1);s.forEach((t=>n.add(t,null)));const c=r?Rt(t,e,r):[Ft(t,e)];e.outputs().map((t=>n.add(t,[])));const l=u.length-1;let f=0;for(let t=0;t<l;++t)f+=u[t+1]=e.write(c[t],n.data,u[t]);if(r){const e=t.data();s.forEach(((t,r)=>{const s=n.data[t]=Array(f),c=o[r];for(let t=0,n=0;t<i;++t)s.fill(c(a[t],e),n,n+=u[t+1])}))}return n.new(t)}(this,t)}rollup(t){return $n(this,t)}sample(t,e){return yr(this,t,e)}select(...t){return On(this,...t)}ungroup(){return Qn(this)}unorder(){return function(t){return t.isOrdered()?t.create({order:null}):t}(this)}dedupe(...t){return Rn(this,...t)}impute(t,e){return function(t,e,n={}){if((e=en(e,{table:t})).names.forEach((e=>t.column(e)?0:at(`Invalid impute column ${Y(e)}`))),n.expand){const r={preparse:Zn,window:!1,aggronly:!0},o=yn("impute",t,n.expand,r),s=Mn(Qn(t),o);return Kn(t,e,o.names,o.names.map((t=>s.get(t,0))))}return Kn(t,e)}(this,t,e)}fold(t,e){return Yn(this,t,e)}pivot(t,e,n){return lr(this,t,e,n)}spread(t,e){return xr(this,t,e)}unroll(t,e){return function(t,e,n){return Bn(t,yn("unroll",t,e),n&&n.drop?{...n,drop:yn("unroll",t,n.drop).names}:n)}(this,t,e)}lookup(t,e,...n){return ar(this,t,e,...n)}join(t,e,n,r){return nr(this,t,e,n,r)}join_left(t,e,n,r){return nr(this,t,e,n,{...r,left:!0,right:!1})}join_right(t,e,n,r){return nr(this,t,e,n,{...r,left:!1,right:!0})}join_full(t,e,n,r){return nr(this,t,e,n,{...r,left:!0,right:!0})}cross(t,e,n){return function(t,e,n,r){return nr(t,e,(()=>!0),n,{...r,left:!0,right:!0})}(this,t,e,n)}semijoin(t,e){return Gn(this,t,e)}antijoin(t,e){return Jn(this,t,e)}concat(...t){return Nn(this,...t)}union(...t){return function(t,...e){return Rn(Nn(t,e.flat()))}(this,...t)}intersect(...t){return function(t,...e){e=e.flat();const n=t.columnNames();return e.length?Rn(e.reduce(((t,e)=>Gn(t,e.select(n))),t)):t.reify([])}(this,...t)}except(...t){return function(t,...e){if(0===(e=e.flat()).length)return t;const n=t.columnNames();return Rn(e.reduce(((t,e)=>Jn(t,e.select(n))),t))}(this,...t)}toArrow(t){return Mr(this,t)}toArrowIPC(t){return Or(this,t)}toCSV(t){return kr(this,t)}toHTML(t){return Ar(this,t)}toJSON(t){return Rr(this,t)}toMarkdown(t){return qr(this,t)}}function Pr(t){const e=t.slice(-3).toLowerCase();return".gz"===e?"gzip":".zz"===e?"deflate":null}async function Lr(t,{fetch:e,decompress:n=Pr(t)}={}){const r=await fetch(t,e).then((t=>t.body));return n?r.pipeThrough(new DecompressionStream(n)):r}function Gr(t){if(it(t[Symbol.asyncIterator]))return t[Symbol.asyncIterator]();{const e=t.getReader();return{next:()=>e.read(),[Symbol.asyncIterator](){return this}}}}async function Jr(t){return _(t)?JSON.parse(t):t instanceof ReadableStream?JSON.parse(await async function(t){if(_(t))return t;let e="";for await(const n of Gr(t))e+=n;return e}(t)):t}function Hr(t,e){const{columns:n=mn(),...r}=e||{},o=t instanceof ArrayBuffer||t instanceof Uint8Array?s(t,{useDate:!0,...r}):t,{fields:a}=o.schema,i=a.map((t=>t.name)),u=cn({columnNames:t=>t?i.filter(t):i.slice(),columnIndex:t=>i.indexOf(t)},n),c=bn();return u.forEach(((t,e)=>{const n=o.getChild(e);c.add(t,-1===n.type.typeId?function(t){const{data:e,length:n,nullCount:r}=t,o=e[e.length-1],s=o.cache??o.dictionary.toArray(),a=s.length,i=function(t,e,n,r){const o=t.length>1||n?function(t,e){const n=t[0].values.constructor,r=new n(e),o=t.length;for(let e,n=0,s=0;n<o;++n)e=t[n].length,r.set(t[n].values.subarray(0,e),s),s+=e;return r}(t,e):t[0].values;return n?function(t,e,n){const r=t.length;for(let o,s=0,a=0;s<r;++s){const r=t[s],{length:i}=r,u=r.validity??r.nullBitmap,c=i>>3;if(u&&u.length)for(let t=0;t<=c;++t)if(255!==(o=u[t])){const r=a+(t<<3);1&o||(e[r+0]=n),2&o||(e[r+1]=n),4&o||(e[r+2]=n),8&o||(e[r+3]=n),16&o||(e[r+4]=n),32&o||(e[r+5]=n),64&o||(e[r+6]=n),128&o||(e[r+7]=n)}a+=i}return e}(t,o,r):o}(e,n,r,a),u=r?t=>t===a?null:s[t]:t=>s[t];return{length:n,nullCount:r,at:t=>u(i[t]),key:t=>i[t],keyFor(t){if(null===t)return r?a:-1;for(let e=0;e<a;++e)if(s[e]===t)return e;return-1},groups(t){const e=a+(r?1:0);return{keys:i,get:[u],names:t,rows:d(0,e),size:e}},[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t.toArray()}}(n):n)})),new Ir(c.data,c.names)}async function Vr(t,e){return Hr(await async function(t){const e=[];let n,r=0;for await(const n of Gr(t))r+=n.length,e.push(n);if(e.length>1){n=new Uint8Array(r);for(let t=0,r=0;t<e.length;++t)n.set(e[t],r),r+=e[t].length}else n=e[0];return n}(t),e)}async function Wr(t,e){return Vr(await Lr(t,e),e)}function Br(t){return t.slice(1,-1).replace(/""/g,'"')}function Yr(t=","){1!==t.length&&at(`Text delimiter should be a single character, found "${t}"`);const e=t.charCodeAt(0);let n=0,r=0,o=0,s=!1,a=!1,i=!1,u=null,c=null,l=[];function f(t){c=c?c+t:t}function m(){if(s)return s=!1,Cr;const t=n,l=34===u.charCodeAt(t);if(i||l){let e=o&&!l;if(i&&!e?--n:l&&++o,i=!0,!e){for(;++n<r;)if(34===u.charCodeAt(n))if(3==++o)o=1;else if(n+1<r&&34!==u.charCodeAt(n+1)){o=0,e=!0,++n;break}if(!e)return f(u.slice(t,r)),Tr}const m=Br((c??"")+u.slice(t,n));if(o=0,i=!1,c=null,n>=r)return c=m,Tr;const d=u.charCodeAt(n++);return d===zr?s=!0:13===d&&(s=!0,n>=r?a=!0:u.charCodeAt(n)===zr&&++n),m}let m;for(;n<r;){const o=u.charCodeAt(m=n++);if(o===zr)s=!0;else if(13===o)s=!0,n>=r?a=!0:u.charCodeAt(n)===zr&&++n;else if(o!==e)continue;return u.slice(t,m)}return f(u.slice(t,r)),Tr}return{start(){},transform(t,e){u=t,r=u.length,n=0;const o=[];let s;if(a&&(u.charCodeAt(n)===zr&&++n,a=!1),null!=c){if((s=m())===Tr)return void e.enqueue(o);l.push((c??"")+s),c=null}for(;;){if((s=m())===Tr)return void e.enqueue(o);s===Cr?(o.push(l),l=[]):l.push(s)}},flush(t){(l.length||c)&&(null!=c&&l.push(2===o?Br(c):c),t.enqueue([l]))}}}function Qr(t,e,n=jr){const r=function(t,e,n){return t>0?e?(r,o)=>o<t||n(r).startsWith(e):(e,n)=>n<t:e?t=>n(t).startsWith(e):null}(t,e,n);if(!r)return null;let o=0;return{start(){},flush(){},transform(t,e){const n=t.length,s=new i(n);for(let e=0;e<t.length;++e,++o)r(t[e],o)&&s.set(e);e.enqueue(s.count()?t.filter(((t,e)=>!s.get(e))):t)}}}const Zr=[t=>"true"===t||"false"===t,t=>"false"!==t],Kr=[t=>"NaN"===t||(t=+t)===t,t=>+t],Xr=[S,t=>new Date(Date.parse(t))];function to(t){return t&&"."!==t?Kr.map((e=>n=>e(n&&n.replace(t,".")))):Kr}function eo(t,e,n){for(let r=0;r<n;++r){const n=t[r];if(null!=n&&!e(n))return!1}return!0}function no(t,e){let n=t;return e.forEach((t=>{t&&(n=n.pipeThrough(new TransformStream(t)))})),n}function ro(t,e){let n,r=t;const o={desiredSize:-1,error(t){throw new Error(t)},terminate(){},enqueue(t){n.push(t)}};return e.forEach((t=>{null!=t&&(n=[],t.start(o),t.transform(r,o),t.flush(o),r=n.flat())})),r}function oo(t,e){const n={};return t.forEach(((t,r)=>n[t]=e[r])),new Ir(n,t)}function so(t,e,n={}){const r=ro(t,e),{names:o,values:s}=io([r],n);return oo(o,s)}async function ao(t,e,n={}){const r=no(t,e),o=+n.autoMax||1e3,s=Gr(r),a=[];let i=0;for(;i<o;){const t=await s.next(),e=t.value;if(e?.length>0&&(a.push(e),i+=e.length),t.done)break}const{names:u,values:c,parsers:l}=io(a,n),f=u.length;for await(const t of s)for(let e=0;e<t.length;++e){const n=t[e];for(let t=0;t<f;++t)c[t].push(n[t]?l[t](n[t]):null)}return oo(u,c)}function io(t,e){const[n]=t,r=n[0].length,o=+e.autoMax||1e3,s=ut(r,(()=>[]));let a=!1!==e.header?n.shift():e.names;a=a?a.length<r?[...a,uo(r,a.length)]:a:uo(r);for(const e of t)for(let t=0;t<e.length;++t){const n=e[t];for(let t=0;t<r;++t)s[t].push(""===n[t]?null:n[t])}const i=function(t,e,n){const{parse:r={}}=n,o=!1===n.autoType;return t.map(((t,s)=>it(r[t])?r[t]:o?jr:function(t,e){const{decimal:n,limit:r=t.length}=e,o=[Zr,to(n),Xr],s=o.length;for(let e=0;e<s;++e){const[n,s]=o[e];if(eo(t,n,r))return s}return jr}(e[s],n)))}(a,s,{...e,limit:o});return i.forEach(((t,e)=>{if(t===jr)return;const n=s[e];for(let e=0;e<n.length;++e)null!=n[e]&&(n[e]=t(n[e]))})),{names:a,values:s,parsers:i}}function uo(t,e=0){return ut(t-e,(t=>`col${t+e+1}`))}async function co(t,e){return(await Lr(t,e)).pipeThrough(new TextDecoderStream)}function lo(t,e){return so(t,ho(e),e)}async function fo(t,e){return ao(t,ho(e),e)}async function mo(t,e){return fo(await co(t,e),e)}function ho({delimiter:t=",",skip:e=0,comment:n}={}){return[Yr(t),Qr(e,n,(t=>t[0]))]}function po(t){return{start(){},flush(){},transform(e,n){n.enqueue(e.map((e=>t.map((([t,n])=>e.slice(t,n).trim())))))}}}function go(){let t=0,e=!1,n="";function r(r){const o=r.length,s=t;for(;t<o;){const n=r.charCodeAt(t),a=++t;if(13===n)t>=o?e=!0:r.charCodeAt(t)===zr&&++t;else if(n!==zr)continue;return r.slice(s,a)}return n+=r.slice(s,o),Tr}return{start(){},transform(o,s){let a;t=0;const i=[];if(e&&(o.charCodeAt(t)===zr&&++t,e=!1),n){if(a=r(o),a===Tr)return void s.enqueue(i);i.push(n+a),n=""}for(;(a=r(o))!==Tr;)i.push(a);s.enqueue(i)},flush(t){n&&t.enqueue([n])}}}function vo(t,e){return so(t,wo(e),{...e,header:!1})}async function yo(t,e){return ao(t,wo(e),{...e,header:!1})}async function _o(t,e){return yo(await co(t,e),e)}function wo({skip:t=0,comment:e,positions:n,widths:r}={}){n||r||at('Fixed width files require a "positions" or "widths" option.');let o=0;const s=n||r.map((t=>[o,o+=t]));return[go(),Qr(t,e,(t=>t[0])),po(s)]}function bo(t){const e=t.length;for(let n=0;n<e;++n){const e=t.charCodeAt(n);if(e<48||e>57)return!1}return!0}function xo(t,e){const n={};return t.forEach(((t,r)=>n[t]=e[r])),{columns:n,names:t}}function $o(t,e){const n=e??Object.keys(function(t){const e=t.find((t=>t.length));return JSON.parse(e)}(t));return{names:n,values:n.map((()=>[]))}}function Mo(t,e,n){const r=e.length;for(let o=0;o<t.length;++o){const s=t[o];if(s){const t=JSON.parse(s);for(let o=0;o<r;++o)n[o].push(t[e[o]])}}}function Oo(t,e={}){const{columns:n,type:r}=e;let o;if(r===Ur)o=function(t,e,n){const r=ro(t,n),{names:o,values:s}=$o(r,e);return Mo(r,o,s),xo(o,s)}(t,n,ko(e));else{const e=_(t)?JSON.parse(t):t;o=r===Dr||!r&&!p(e)?function(t,e){let n=t;e?n=e.reduce(((e,n)=>(e[n]=t[n],e)),{}):e=Object.keys(n);return{columns:n,names:e}}(e,n):function(t,e){e??=Object.keys(t[0]);const n=e.map((()=>[])),r=t.length,o=e.length;for(let s=0;s<r;++s){const r=t[s];for(let t=0;t<o;++t)n[t].push(r[e[t]])}const s={};return e.forEach(((t,e)=>s[t]=n[e])),{columns:s,names:e}}(e,n)}return So(o,e)}async function jo(t,e={}){return e.type===Ur?So(await async function(t,e,n){const r=Gr(no(t,n));let o;do{o=(await r.next()).value}while(0===o.length);const{names:s,values:a}=$o(o,e);Mo(o,s,a);for await(const t of r)Mo(t,s,a);return xo(s,a)}(t,e.columns,ko(e)),e):Oo(await Jr(t),e)}async function Eo(t,e){const n=await co(t,e);return e?.type||t.slice(-7).toLowerCase()!==`.${Ur}`||(e={...e,type:Ur}),jo(n,e)}function ko({comment:t,skip:e=0}={}){return[go(),Qr(e,t)]}function So({columns:t,names:e},{autoType:n=!0,parse:r}={}){if(n||r){const e=r||{};for(const r in t){const o=t[r],s=o.length;if(e[r])for(let t=0;t<s;++t)o[t]=e[r](o[t]);else if(n)for(let t=0;t<s;++t){const e=o[t];_(e)&&S(e)&&!bo(e)&&(o[t]=new Date(e))}}}return new Ir(t,e)}function No(t,e={}){const n=`d[${JSON.stringify(t)}]`,{maxbins:r,nice:o,minstep:s,step:a,offset:i}=e,u=[r,o,s,a];let c=u.length;for(;c&&null==u[--c];)u.pop();return`d => op.bin(${n}, ...op.bins(${n}${u.length?", "+u.map((t=>t+"")).join(", "):""}), ${i||0})`}function Ao(t){return rn(t,{escape:!0,toString(){at("Escaped values can not be serialized.")}})}function Co(t,e,n){return rn(t,{collate:it(e)?e:new Intl.Collator(e,n).compare})}function To(t){return rn(t,{desc:!0})}function zo(t){return`() => op.round(${+t} * op.count())`}function Do(...t){return t=t.flat(),e=>{const n=new Map,r=Math.min(t.length,e.numCols());for(let o=0;o<r;++o)n.set(e.columnName(o),t[o]);return n}}function Uo(t,e,n){return rn(t,{window:{frame:e||[-1/0,0],peers:!!n}})}function Fo(t,e){return $n(Qn(t),{_:e}).get("_")}function Ro(t,e,n=st,r="function"){t||((t,e)=>{at(`Illegal ${e} name: ${Y(t)}`)})(t,r),!e.override&&Object.hasOwn(n,t)&&((t,e)=>{at(`The ${e} ${Y(t)} is already defined. Use override option?`)})(t,r)}function qo(t,e,n,r){return n[t]===e||Ro(t,r)}function Io(t,e,n,r={}){if(qo(t,e,n,r))return;const[o=0,s=0]=e.param;n[t]=e,st[t]=(...e)=>Z(t,e.slice(0,o),e.slice(o,o+s))}function Po(t,e,n){Io(t,e,ht,n)}function Lo(t,e,n){Io(t,e,vt,n)}function Go(t,e,n={}){1===arguments.length&&(""===(t=(e=t).name)||"anonymous"===t?at("Anonymous function provided, please include a name argument."):t===_e&&((t,e)=>{at(`The ${e} name ${Y(t)} is reserved and can not be overridden.`)})(_e,"function")),qo(t,e,V,n)||(V[t]=e,st[t]=e)}function Jo(t,e){const n=e=>(at(`Illegal argument type: ${e||typeof t}`),{});return t instanceof Map?Ho(t.entries(),e):u(t)?n("Date"):c(t)?n("RegExp"):_(t)?n():p(t)?function(t,e){const n=t.length,r={},o=t=>r[t]=Array(n);if(n){const r=(e=e||Object.keys(t[0])).map(o),s=r.length;for(let o=0;o<n;++o){const n=t[o];for(let t=0;t<s;++t)r[t][o]=n[e[t]]}}else e&&e.forEach(o);return r}(t,e):it(t[Symbol.iterator])?function(t,e){const n={},r=t=>n[t]=[];let o,s;for(const n of t){o||(o=(e=e||Object.keys(n)).map(r),s=o.length);for(let t=0;t<s;++t)o[t].push(n[e[t]])}!o&&e&&e.forEach(r);return n}(t,e):l(t)?Ho(Object.entries(t),e):n()}function Ho(t,e=["key","value"]){const n=[],r=[];for(const[e,o]of t)n.push(e),r.push(o);const o={};return e[0]&&(o[e[0]]=n),e[1]&&(o[e[1]]=r),o}function Vo(t,e){if(t instanceof Ir)return t;const n={},r=[];for(const[e,o]of It(t))n[e]=o,r.push(e);return new Ir(n,e||r)}function Wo(t,e){return new Ir(Jo(t,e),e)}export{i as BitSet,Ir as ColumnTable,kt as Reducer,kn as Table,Po as addAggregateFunction,Go as addFunction,Lo as addWindowFunction,Fo as agg,mn as all,No as bin,Co as collate,To as desc,vn as endswith,Ao as escape,sn as field,zo as frac,Wo as from,Hr as fromArrow,Vr as fromArrowStream,lo as fromCSV,fo as fromCSVStream,vo as fromFixed,yo as fromFixedStream,Oo as fromJSON,jo as fromJSONStream,Wr as loadArrow,mo as loadCSV,_o as loadFixed,Eo as loadJSON,pn as matches,Do as names,dn as not,st as op,en as parse,hn as range,Uo as rolling,q as seed,gn as startswith,Vo as table,Mr as toArrow,Or as toArrowIPC,kr as toCSV,Ar as toHTML,Rr as toJSON,qr as toMarkdown,Yt as walk_ast};export default null;
