<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Precios en Bolivia</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight,wide.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight,wide.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_import/components/files.d3a2fd49.js">
<link rel="modulepreload" href="./_import/components/format.a3232af2.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="icon" href="./_file/favicon.cc2893b5.png" type="image/png">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/cobertura.json", {"name":"./data/cobertura.json","mimeType":"application/json","path":"./_file/data/cobertura.78b46c7b.json","lastModified":1728535140698});
registerFile("./data/cochabamba.csv", {"name":"./data/cochabamba.csv","mimeType":"text/csv","path":"./_file/data/cochabamba.d6417c13.csv","lastModified":1728535139370});
registerFile("./data/la_paz.csv", {"name":"./data/la_paz.csv","mimeType":"text/csv","path":"./_file/data/la_paz.f7b0895d.csv","lastModified":1728535139918});
registerFile("./data/productos.json", {"name":"./data/productos.json","mimeType":"application/json","path":"./_file/data/productos.a1ad6fd3.json","lastModified":1728535140698});
registerFile("./data/santa_cruz.csv", {"name":"./data/santa_cruz.csv","mimeType":"text/csv","path":"./_file/data/santa_cruz.46d452e8.csv","lastModified":1728535140434});

define({id: "09166b80", outputs: ["files","Trend"], body: async () => {
const [{files}, {Trend}] = await Promise.all([import("./_import/components/files.d3a2fd49.js"), import("./_import/components/format.a3232af2.js")]);
// Imports

return {files,Trend};
}});

define({id: "0fb55661", inputs: ["Inputs","files","Generators"], outputs: ["ciudades","ciudad"], body: (Inputs,files,Generators) => {
// Ciudades
const ciudades = Inputs.radio(Object.keys(files), {
    format: (d) => files[d].name,
    label: "En",
    value: "la_paz",
});
const ciudad = Generators.input(ciudades);
return {ciudades,ciudad};
}});

define({id: "eab7cc28", inputs: ["FileAttachment","files","ciudad"], outputs: ["productos","data"], body: async (FileAttachment,files,ciudad) => {
// Datos
const productos = await FileAttachment("./data/productos.json").json();
let data = await files[ciudad].file.csv({ typed: true });
data = data.map((d) => {
    return { ...d, ...productos[d.id_producto] };
});
return {productos,data};
}});

define({id: "ece3cbd2", inputs: ["FileAttachment","Inputs","Generators"], outputs: ["cobertura","dias","dia"], body: async (FileAttachment,Inputs,Generators) => {
// Tiempo
const cobertura = await FileAttachment("./data/cobertura.json").json()
const dias = Inputs.select(Object.keys(cobertura), {
    value: 1,
    format: (d) => cobertura[d],
    label: "Cambios desde",
});
const dia = Generators.input(dias);
return {cobertura,dias,dia};
}});

define({id: "530abf1d", inputs: ["data","dia","Inputs","Generators"], outputs: ["dataDia","categorias","sugerencias","sugerencia"], body: (data,dia,Inputs,Generators) => {
// Sugerencias
const dataDia = data.filter((d) => d.hoy && d[dia]);
const categorias = Object.fromEntries(
    Object.entries(
        dataDia
            .filter((d) => d[`${dia}_cambio`] > 0)
            .reduce(
                (acc, d) => ({
                    ...acc,
                    [d.subcategoria]: (acc[d.subcategoria] || 0) + 1,
                }),
                {}
            )
    )
        .filter(([_, count]) => count >= 5)
        .sort(([, a], [, b]) => b - a)
);
const sugerencias = Inputs.radio(Object.keys(categorias).slice(0, 12));
const sugerencia = Generators.input(sugerencias);
return {dataDia,categorias,sugerencias,sugerencia};
}});

define({id: "da2ae9de", inputs: ["Inputs","dataDia","sugerencia","Generators"], outputs: ["busqueda","resultado"], body: (Inputs,dataDia,sugerencia,Generators) => {
// Búsqueda
const busqueda = Inputs.search(dataDia, {
    query: sugerencia,
    columns: ["producto", "subcategoria"],
    placeholder: "Busca ...",
    format: (d) => `${d} productos`,
});
const resultado = Generators.input(busqueda);
return {busqueda,resultado};
}});

define({id: "0b3690ae", inputs: ["Inputs","resultado","dia","cobertura","Trend"], outputs: ["tabla"], body: (Inputs,resultado,dia,cobertura,Trend) => {
// Tabla
const tabla = Inputs.table(resultado, {
    columns: ["producto", dia, "hoy", `${dia}_cambio`],
    header: {
        [dia]: cobertura[dia],
        [`${dia}_cambio`]: "variación",
    },
    format: {
        [`${dia}_cambio`]: (d) => Trend(d),
    },
    width: {
        producto: 250,
        [dia]: 50,
        hoy: 50,
        [`${dia}_cambio`]: 60,
    },
    sort: `${dia}_cambio`,
    rows: 34,
    reverse: true,
});
return {tabla};
}});

define({id: "e471f4fa", mode: "inline", inputs: ["ciudades","display"], body: async (ciudades,display) => {
display(await(
ciudades
))
}});

define({id: "d470eac9", mode: "inline", inputs: ["dias","display"], body: async (dias,display) => {
display(await(
dias
))
}});

define({id: "feecd4f3", mode: "inline", inputs: ["sugerencias","display"], body: async (sugerencias,display) => {
display(await(
sugerencias
))
}});

define({id: "4e957b19", mode: "inline", inputs: ["busqueda","display"], body: async (busqueda,display) => {
display(await(
busqueda
))
}});

define({id: "4a106a9d", mode: "inline", inputs: ["tabla","display"], body: async (tabla,display) => {
display(await(
tabla
))
}});

</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<link rel="stylesheet" href="./_file/style.d6d82293.css">
<div class="observablehq observablehq--block"><!--:09166b80:--></div>
<div class="observablehq observablehq--block"><!--:0fb55661:--></div>
<div class="observablehq observablehq--block"><!--:eab7cc28:--></div>
<div class="observablehq observablehq--block"><!--:ece3cbd2:--></div>
<div class="observablehq observablehq--block"><!--:530abf1d:--></div>
<div class="observablehq observablehq--block"><!--:da2ae9de:--></div>
<div class="observablehq observablehq--block"><!--:0b3690ae:--></div>
<div class="grid grid-cols-3 controls">
    <div class="card grid-colspan-1">
        <observablehq-loading></observablehq-loading><!--:e471f4fa:-->
        <observablehq-loading></observablehq-loading><!--:d470eac9:-->
    </div>
    <div class="card grid-colspan-2">
        <div class="sugerencias">
          <observablehq-loading></observablehq-loading><!--:feecd4f3:-->
        </div>
        <observablehq-loading></observablehq-loading><!--:4e957b19:-->
    </div>
</div>
<div class="card">
    <observablehq-loading></observablehq-loading><!--:4a106a9d:-->
</div>
</main>
</div>
