<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Precios en Bolivia</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight,wide.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight,wide.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/arquero@8.0.3/_esm.js">
<link rel="modulepreload" href="./_import/components/files.f7e2c758.js">
<link rel="modulepreload" href="./_import/components/format.77702a7a.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/acorn@8.15.0/_esm.js">
<link rel="modulepreload" href="./_npm/@uwdata/flechette@2.3.0/_esm.js">
<link rel="icon" href="./_file/favicon.cc2893b5.png" type="image/png">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/cobertura.json", {"name":"./data/cobertura.json","mimeType":"application/json","path":"./_file/data/cobertura.62219629.json","lastModified":1770207415631});
registerFile("./data/cochabamba.csv", {"name":"./data/cochabamba.csv","mimeType":"text/csv","path":"./_file/data/cochabamba.eb5ac2a4.csv","lastModified":1770207406187});
registerFile("./data/la_paz.csv", {"name":"./data/la_paz.csv","mimeType":"text/csv","path":"./_file/data/la_paz.f2fd87e3.csv","lastModified":1770207410932});
registerFile("./data/productos.json", {"name":"./data/productos.json","mimeType":"application/json","path":"./_file/data/productos.68eeb77d.json","lastModified":1770207415631});
registerFile("./data/santa_cruz.csv", {"name":"./data/santa_cruz.csv","mimeType":"text/csv","path":"./_file/data/santa_cruz.258928a7.csv","lastModified":1770207415304});

define({id: "72925c9c", outputs: ["aq","files","Trend"], body: async () => {
const [aq, {files}, {Trend}] = await Promise.all([import("./_npm/arquero@8.0.3/_esm.js"), import("./_import/components/files.f7e2c758.js"), import("./_import/components/format.77702a7a.js")]);
// Imports

return {aq,files,Trend};
}});

define({id: "fdc120d6", inputs: ["localStorage"], outputs: ["default_ciudad","stored_ciudad","selected_ciudad"], body: (localStorage) => {
const default_ciudad = "la_paz";
const stored_ciudad = localStorage.getItem("ciudad");
const selected_ciudad = stored_ciudad
    ? stored_ciudad
    : default_ciudad;
return {default_ciudad,stored_ciudad,selected_ciudad};
}});

define({id: "6cb463d6", inputs: ["localStorage","ciudad"], body: (localStorage,ciudad) => {
localStorage.setItem("ciudad", ciudad);
}});

define({id: "f108d49a", inputs: ["Inputs","files","selected_ciudad","Generators"], outputs: ["ciudades","ciudad"], body: (Inputs,files,selected_ciudad,Generators) => {
// Ciudades
const ciudades = Inputs.radio(Object.keys(files), {
    format: (d) => files[d].name,
    label: "En",
    value: selected_ciudad,
});
const ciudad = Generators.input(ciudades);
return {ciudades,ciudad};
}});

define({id: "eab7cc28", inputs: ["FileAttachment","files","ciudad"], outputs: ["productos","data"], body: async (FileAttachment,files,ciudad) => {
// Datos
const productos = await FileAttachment("./data/productos.json").json();
let data = await files[ciudad].file.csv({ typed: true });
data = data.map((d) => {
    return { ...d, ...productos[d.id_producto] };
});
return {productos,data};
}});

define({id: "a00e337c", inputs: ["localStorage"], outputs: ["default_dias","stored_dias","selected_dias"], body: (localStorage) => {
const default_dias = "3";
const stored_dias = localStorage.getItem("dias");
const selected_dias = stored_dias
    ? stored_dias
    : default_dias;
return {default_dias,stored_dias,selected_dias};
}});

define({id: "f451b4ca", inputs: ["localStorage","dia"], body: (localStorage,dia) => {
localStorage.setItem("dias", dia);
}});

define({id: "0ebe9762", inputs: ["FileAttachment","Inputs","selected_dias","Generators"], outputs: ["cobertura","dias","dia"], body: async (FileAttachment,Inputs,selected_dias,Generators) => {
// Tiempo
const cobertura = await FileAttachment("./data/cobertura.json").json();
const dias = Inputs.select(Object.keys(cobertura), {
    value: selected_dias,
    format: (d) => cobertura[d],
    label: "Cambios desde",
});
const dia = Generators.input(dias);
return {cobertura,dias,dia};
}});

define({id: "5f9b1b33", inputs: ["aq"], outputs: ["dolarData"], body: async (aq) => {
// Cotización del dolar
const dolarData = await aq.loadCSV(
    `https://raw.githubusercontent.com/mauforonda/dolares/main/buy.csv`
);
return {dolarData};
}});

define({id: "5c313427", inputs: ["dolarData","aq","cobertura","Trend","dia"], outputs: ["dolarDiario","dolarCambio","dolarString"], body: (dolarData,aq,cobertura,Trend,dia) => {
// Variaciones del dólar
const dolarDiario = dolarData
    .filter((d) => d.vwap != null)
    .derive({
        date: aq.escape(
            (d) => aq.op.split(aq.op.format_date(d.timestamp), "T")[0]
        ),
    })
    .groupby("date")
    .rollup({
        median_vwap: (d) => aq.op.median(d.vwap),
    })
    .orderby(aq.desc("date"));
const dolarCambio = Object.fromEntries(
    Object.keys(cobertura).map((d) => {
        const dia = Number(d);
        const hoy = dolarDiario.get("median_vwap", 0);
        const previo = dolarDiario.get("median_vwap", dia);
        return [dia, (hoy - previo) / previo];
    })
);
const dolarString = Trend(dolarCambio[dia], {
    format: { minimumFractionDigits: 2 },
});
return {dolarDiario,dolarCambio,dolarString};
}});

define({id: "530abf1d", inputs: ["data","dia","Inputs","Generators"], outputs: ["dataDia","categorias","sugerencias","sugerencia"], body: (data,dia,Inputs,Generators) => {
// Sugerencias
const dataDia = data.filter((d) => d.hoy && d[dia]);
const categorias = Object.fromEntries(
    Object.entries(
        dataDia
            .filter((d) => d[`${dia}_cambio`] > 0)
            .reduce(
                (acc, d) => ({
                    ...acc,
                    [d.subcategoria]: (acc[d.subcategoria] || 0) + 1,
                }),
                {}
            )
    )
        .filter(([_, count]) => count >= 5)
        .sort(([, a], [, b]) => b - a)
);
const sugerencias = Inputs.radio(Object.keys(categorias).slice(0, 12));
const sugerencia = Generators.input(sugerencias);
return {dataDia,categorias,sugerencias,sugerencia};
}});

define({id: "da2ae9de", inputs: ["Inputs","dataDia","sugerencia","Generators"], outputs: ["busqueda","resultado"], body: (Inputs,dataDia,sugerencia,Generators) => {
// Búsqueda
const busqueda = Inputs.search(dataDia, {
    query: sugerencia,
    columns: ["producto", "subcategoria"],
    placeholder: "Busca ...",
    format: (d) => `${d} productos`,
});
const resultado = Generators.input(busqueda);
return {busqueda,resultado};
}});

define({id: "0b3690ae", inputs: ["Inputs","resultado","dia","cobertura","Trend"], outputs: ["tabla"], body: (Inputs,resultado,dia,cobertura,Trend) => {
// Tabla
const tabla = Inputs.table(resultado, {
    columns: ["producto", dia, "hoy", `${dia}_cambio`],
    header: {
        [dia]: cobertura[dia],
        [`${dia}_cambio`]: "variación",
    },
    format: {
        [`${dia}_cambio`]: (d) => Trend(d),
    },
    width: {
        producto: 250,
        [dia]: 50,
        hoy: 50,
        [`${dia}_cambio`]: 60,
    },
    sort: `${dia}_cambio`,
    rows: 34,
    reverse: true,
});
return {tabla};
}});

define({id: "e471f4fa", mode: "inline", inputs: ["ciudades","display"], body: async (ciudades,display) => {
display(await(
ciudades
))
}});

define({id: "d470eac9", mode: "inline", inputs: ["dias","display"], body: async (dias,display) => {
display(await(
dias
))
}});

define({id: "feecd4f3", mode: "inline", inputs: ["sugerencias","display"], body: async (sugerencias,display) => {
display(await(
sugerencias
))
}});

define({id: "4e957b19", mode: "inline", inputs: ["busqueda","display"], body: async (busqueda,display) => {
display(await(
busqueda
))
}});

define({id: "104b6281", mode: "inline", inputs: ["dolarString","display"], body: async (dolarString,display) => {
display(await(
dolarString
))
}});

define({id: "4a106a9d", mode: "inline", inputs: ["tabla","display"], body: async (tabla,display) => {
display(await(
tabla
))
}});

</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<link rel="stylesheet" href="./_file/style.81115296.css">
<div class="observablehq observablehq--block"><!--:72925c9c:--></div>
<div class="observablehq observablehq--block"><!--:fdc120d6:--></div>
<div class="observablehq observablehq--block"><!--:6cb463d6:--></div>
<div class="observablehq observablehq--block"><!--:f108d49a:--></div>
<div class="observablehq observablehq--block"><!--:eab7cc28:--></div>
<div class="observablehq observablehq--block"><!--:a00e337c:--></div>
<div class="observablehq observablehq--block"><!--:f451b4ca:--></div>
<div class="observablehq observablehq--block"><!--:0ebe9762:--></div>
<div class="observablehq observablehq--block"><!--:5f9b1b33:--></div>
<div class="observablehq observablehq--block"><!--:5c313427:--></div>
<div class="observablehq observablehq--block"><!--:530abf1d:--></div>
<div class="observablehq observablehq--block"><!--:da2ae9de:--></div>
<div class="observablehq observablehq--block"><!--:0b3690ae:--></div>
<div class="header">
    <div class="title">Precios</div>
    <div class="subtitle">
        ¿ Qué precios <span class="up">suben</span> o <span class="down">bajan</span> en Bolivia ?
    </div>
</div>
<div class="grid grid-cols-3 controls">
    <div class="card grid-colspan-1">
        <div class="ciudades">
            <observablehq-loading></observablehq-loading><!--:e471f4fa:-->
        </div>
        <div class="tiempo">
            <observablehq-loading></observablehq-loading><!--:d470eac9:-->
        </div>
    </div>
    <div class="card grid-colspan-2">
        <div class="sugerencias">
          <observablehq-loading></observablehq-loading><!--:feecd4f3:-->
        </div>
        <div class="busqueda">
            <observablehq-loading></observablehq-loading><!--:4e957b19:-->
        </div>
    </div>
</div>
<div class="dolar"> ... mientras tanto el dolar cambió en <observablehq-loading></observablehq-loading><!--:104b6281:--></div>
<div class="card precios">
    <observablehq-loading></observablehq-loading><!--:4a106a9d:-->
</div>
<div id="creditos">
    <div class="credito">
        <span><a href="https://hipermaxi.com/" target="_blank" rel="noopener noreferrer">Hipermaxi</a></span>
        <span class="creditoNota">fuente</span>
    </div>
    <div>&amp;</div>
    <div class="credito">
        <span><a href="mailto:mauriforonda@gmail.com" target="_blank" rel="noopener noreferrer">Mauricio Foronda</a></span>
        <span class="creditoNota">creación</span>
    </div>
</div>
</main>
</div>
